02-11-2020
1. Assert.isTrue(ListA.containsAll(listB)
	and Assert.isTrue(ListB.containsAll(listA). Then two lists are equal.
	Can use for assert in automation where no sort is fixed and cannot compare equality for two objects directly.
---------------------------------------------------------------------
02-05-2020
1. When writing API automation, need to think not only about the user perspective but also through data perspective. Like Database if it has null rows,
	how does api handle it.
2.  Creating an object like this: 
	private static final FileSubmissionInformationEntity DATA_FILE_SUBMISSION_INFORMATION_ENTITY = new FileSubmissionInformationEntity()
    {{
        setId(10001);
        setFileName("dataFileName");
        setAssociatedMetadataFileSubmissionId(META_FILE_SUBMISSION_ID);
        setEventSubmissionId(EVENT_SUBMISSION_ID);
        setCreatedBy(USER_ID);
    }};
	
	  Map<FileTypeEnum, String> integrityResult = new HashMap<FileTypeEnum, String>()
	{{
		put(FileTypeEnum.DATA, " AND D.INTEGRITY_RESULT IS NULL ");
		put(FileTypeEnum.META, " AND M.INTEGRITY_RESULT IS NULL ");
	}};
3. SSH public key error while pushing to repo? Maybe the private key is not setup for ssh.
	Easy way: Change the remote origin to HTTPs instead of SSH.
	command:	git remote set-url origin https://github.com/USERNAME/REPOSITORY.git
4. QueryDsl Tuple:
	Since Querydsl 3.0 the default type for multi-column results is com.mysema.query.Tuple.
	Tuple provides provides a typesafe Map like interface to access column data from a Tuple row object.
5. SQL query :
	NULLIF(expr1, expr2)
	The NULLIF() function returns NULL if two expressions are equal, otherwise it returns the first expression.
	example : "COALESCE(NULLIF(EVENT_TYPE_CD,''),'N/A')";
6. Number comes first, then Uppercase, then lower case in Ascii order
7. Fix file name too long problem for git in windows:
	run command : 'git config --system core.longpaths true' -> as an admin
8. For positive scenarios, we need to make db call then find the date or imid and stuff that we want to use for our call. DO NOT HARDCODE as the data
	might be deleted. For negative scenarios, we can give any dates or any query params value.
9. Fix file name too long problem while running applications and tests in intelliJ,
	Go to the .idea folder for intelliJ, and update the Workspace.xml:
	Add 
	<property name="dynamic.classpath" value="true" /> to
	  <component name="PropertiesComponent">
	.
	.
	.
	  </component>
10. Never blindly convert the SQL query to uppercase, the sql query itself is okay to convert to uppercase as long as the value for the column is not. Values are case sensitive.
	SQL commands itself arent
------------------------------------------------------------------------------------
01-30-2020
1. Query does not have any params that is why we use (Map<String, ?>) null. And supress warning
	@Override
    @edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = "NP_NONNULL_PARAM_VIOLATION")
    public Long getNextAvailableEventSubmissionId()
    {
        return namedParameterJdbcTemplate.queryForObject(eventQueries.getQueryValues(GET_EVENT_SUBMISSION_ID), (Map<String, ?>) null, Long.class);
    }
2. RowMapper to map sql columns to  dto, and 
	MapSqlParameterSource sqlParameterSource = new MapSqlParameterSource(); to set value in query for namedParameterJdbcTemplate
3.  Convert list to string using stream.
	eventIds.stream().map(String::valueOf).collect(Collectors.joining(","));
4. EqualsBuilder().append(catSubmitterId, that.catSubmitterId).append(catReporterIndustryMemberId, that.catReporterIndustryMemberId).isEquals();
	HashCodeBuilder(17, 37).append(catSubmitterId).append(catReporterIndustryMemberId).toHashCode();
	--> Build equals and hashcode method for any class;
5. ‘this’ is a reference variable that refers to the current object.
6. BuilderPattern
7. StringUtil.SPACE, StringUtil.COMMA from package io.netty.util.internal;
8.	public static Stream<Role> usersRoles()
    {
        return DataProviders.ewsAccountUsersRole();
    }

	@ParameterizedTest
    @MethodSource("usersRoles")
    @Tag("api")
    @Tag("file status")
    @Publish(name = "Verify individual roles to get File status", description = "All the user roles should be able to see the File status", coverage = "CATDD-1374")
    public void testRolesFileStatusWithAllParams(Role role)
    {
        try
        {
            Map<String, Object> queryParam = new HashMap<>();
            queryParam.put(QueryParams.CAT_ORGANIZATION_ID.getValue(), String.valueOf(role.getOrgId()));
			.....
		}
	}
	@MethodSource repeates the value for provided parameters to check for all the possibilities.
------------------------------------------------------------------------------
01-27-2020
1. When need to mock.
	when(currentUserService.getCurrentUserInfo.getUser.getUserId).thenReturn("abc") does not work.
	Need to mock individually. Mock CurrentUserService, then mock CurrentUserInfo, then mock User.
2. By default no argument constructor.if parametrized constructor added, need to explicitly add default constructor.
3. BigInteger is capable of holding far bigger numbers than Long.
4. SELECT nextval('catdd_owner.sbmsn_id_seq')
5. PlatformTransactionManager :
		 @Autowired
	     private PlatformTransactionManager transactionManager;
	  TransactionDefinition def = new DefaultTransactionDefinition();
      TransactionStatus status = transactionManager.getTransaction(def);
6.  when(memberDictionaryRepositoryCustom.findBySearchCriteria(any(), any(), any(), any(), any())).thenReturn(memberDictionaryEntityList);
	-> if the argument is null, then when mocking, we cant use anyString because it gives "", use any() which can be null.
7. Findbugs supress:
	    @edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = "REC_CATCH_EXCEPTION", justification = "Need to capture all exceptions during parsing")
8. LinkedHashSet preserves the insertion order. Other Set does not preserve order.
9. Remove the duplicates from a list -> List<String> newList = myList.stream().distinct().collect(Collectors.toList())
10. Sort online tool:
	https://www.online-utility.org/text/sort.jsp
11. natural sorting order.
12. Collections.sort().....Collections.reverse()
13. List<Integer> newSortedList = list.stream().sorted().collect(Collectors.toList());
	List<Integer> newSortedList = list.stream().sorted(Comparator.reverseOrder().collect(Collectors.toList());
14. List<String> newList = myList.stream().distinct().sorted().collect(Collectors.toList())  -> Remove duplicate and sort
15. TreeSet will sort elements (Strings) alphabetically. you can eliminate stream().distinct().sorted().collect(Collectors.toList());
	ex: List<String> list = Arrays.asList("image0", "image8", "image15", "image9", "image21");
        System.out.println("Stream --->"+list.stream().sorted().collect(Collectors.toList()));
        System.out.println("Treeset --->"+new TreeSet<>(list));
16. We can actually check for what commit the ci build in jenkins ran, we can compare the log(Jenkins)'s commit number with the
	commitnumber(bitbucket). Bitbucket->Commit
17.     // create SQS message with submissionId and send to SQS url
        AmazonSQS sqsClient = AmazonSQSClientBuilder.defaultClient();
        SendMessageRequest sendMessageRequest = new SendMessageRequest()
                .withQueueUrl(sqsUrl)
                .withMessageBody(submissionId.toString());
        sqsClient.sendMessage(sendMessageRequest);
18. combinedList.sort(Comparator.comparing(FileStatusDto::getUploadTimestamp, Comparator.nullsFirst(Comparator.naturalOrder())).reversed());
19. In sql query,  ORDER BY UPLOAD_TIMESTAMP DESC NULLS FIRST
20. HH:mm:ss -> 24 hour format, hh:mm:ss -> 12 hour format
21. Java.util	
	eventTypeStatisticsList.sort(
            Comparator.comparing(EventTypeStatistics::getCatReporterIndustryMemberId).thenComparing(EventTypeStatistics::getCatSubmitterId)
                .thenComparing(EventTypeStatistics::getEventType,Comparator.nullsLast(Comparator.naturalOrder())));
22. Using comparator:
     Collections.sort(actualFileStatusInfo.getFileStatusDetailOutputs(), new FileStatusDetailOutputComparator());
public class FileStatusDetailOutputComparator implements Comparator<FileStatusDetailOutput>
{
    @Override
    public int compare(FileStatusDetailOutput o1, FileStatusDetailOutput o2)
    {
        return new CompareToBuilder()
            .append(o2.getUpload().getTimestamp(), o1.getUpload().getTimestamp())
            .append(o1.getUploadedFileName(), o2.getUploadedFileName())
            .toComparison();
    }
}
    @Override
    public int compare(FileStatusDetailOutput o1, FileStatusDetailOutput o2)
    {
        int compareUploadTimestamp = o1.getUpload().getTimestamp().compareTo(o2.getUpload().getTimestamp());
        int compareFileName = o1.getUploadedFileName().compareTo(o2.getUploadedFileName());

        if(compareUploadTimestamp == 0)
        {
            return compareFileName;
        }
        else
        {
            return compareUploadTimestamp;
        }
    }
----------------------------------------------------------------------
01-21-2020
1. a String is immutable, meaning you cannot change a String in Java. concat() returns a new concatenated string.
	s = s.concat("ING"); works but s.concat("ING") wont cut it
2. /**
	 * The base integration test for java application. Test Classes extends this class
	 */
	@ExtendWith(SpringExtension.class)
	@SpringBootTest
	@ActiveProfiles("test")
	abstract public class BaseIntegrationTest
	{
	}

3. java -jar -Dspring.profiles.active=Application catdd-portal-api-app-0.4.0-SNAPSHOT.jar -> To run with a profile using command line
   To set it up in intelliJ. Run -> Edit Confugurations -> VM Options -> Set as -Dspring.profiles.active=Application
4. java.sql.date, Date.valueOf("2019-01-01") instead of new Date(). new Date() requires a long(milliSeconds)
5. There is a subtle difference between null and blank(“”). Null means we are not pulling the data from the database, while “” means we are pulling the data from DB but its value in DB is empty
6. When we use argument matchers, then all the arguments should use matchers. If we want to use a specific value for an argument, then we can use eq() method.
	For example:  when(namedParameterJdbcTemplate.queryForObject(queryCaptor.capture(), parameterMapCaptor.capture(), eq(Long.class))).thenReturn(1200L);
	If the method arguments has Class, for example : we can still use it
	namedParameterJdbcTemplate.queryForObject(errorSummaryQueryBuilder.toString(), parameterMap, Long.class)
7.  String eventIdListInString = eventIds.stream().map(eventId -> String.valueOf(eventId)).collect(Collectors.joining(","));
8. "CAST(info.crctn_due_ts as TEXT)" = '2019-11-13 00:00:00'.........casting in query
9. To setup artifactory....Go to .m2 folder in the users folder. then go to artifactory:
	https://artifactory.finra.org/artifactory/webapp/#/home
	Go to the profile. Get the passkey and update the settings.xml
10. To setup the aws location, go to the .aws folder
--------------------------------------------------------------------------------------------------------
01-15-2019
1. When declaring static final variable for Map and list need to make it immutable:
	    public static final Map<String, String> SORT_TYPE_MAP =
        ImmutableMap.<String, String>builder()
            .put(SortTypeEnum.ASCENDING.getValue(), "asc")
            .put(SortTypeEnum.DESCENDING.getValue(), "desc")
            .build();
		
		ImmutableSet.of(Arrays.asList(1,2))
2. Insead of this:             for (String key : filterModel.keySet()), where you have to do filterModel.get(key).getFilterType()
	Do this: 				   Map.Entry<String, ColumnFilter> entry : filterModel.entrySet()
								 String key = entry.getKey();
								 ColumnFilter value = entry.getValue();
								where we can use : value.getFilterType()
3. String manipulation plugin for intellij to switch camelCase to snake-underscore(Alt + m. Then 4, 2) and others too
4. KeyHolder holder = new GeneratedKeyHolder();
5. @edu.umd.cs.findbugs.annotations.SuppressFBWarnings(value = "REC_CATCH_EXCEPTION", justification = "Need to capture all exceptions during parsing")
6. @JsonIgnore properties to ignore fields both when reading JSON into Java objects, and when writing Java objects into JSON.
	@JsonIgnoreProperties({"firstName", "lastName"}) -> Class Level
	@JsonIgnore -> Method level
7. @Bean loaded during application start up.
8. EventTypes eventTypes = JsonUtils.unmarshal(fileHelper.readFileFromClassPath(EVENT_TYPES_RESOURCE_NAME), EventTypes.class);
	JsonUtils.unmarshal uses ObjectMapper internally to map. Json Utils is custom class in Catdd application. 
	JsonUtils is a catdd application util class.
	ObjectMapper uses column name to map the columns. So name should match

--------------------------------------------------------------------------------------------------------------
01-09-2020
1. JsonUtils.unmarshal(fileHelper.readFileFromClassPath(EVENT_QUERY_RESOURCE_NAME), EventQueries.class)
	EventQueries.class should have a variable with name matching that of the json fileName that we are reading from. Thats how its mapped
2. pndng_rec, err_rec_info, err_rec_cd, err_cd_lk should all have the matching data to get anything from errorSummary endpoint. matching errorRoeId, reporter, imid etc
3. Sql:
	case when .... then.... else... -> like if else.... 
	Coalesce -> return the first non null value
	SELECT min(rec_rprtr_imid) as imid from catdd_owner.pndng_rec; -> min of string (alphabetical)
4. Make method protected so that we can unit test instead of private.
5. Run two list at the same time for one result combining both:
	    Iterator<Object> filterValueIterator = filterValue.iterator();
        Iterator<ColumnNameEnum> columnNameEnumIterator = columnNameEnumFilterList.iterator();
        while(columnNameEnumIterator.hasNext() && filterValueIterator.hasNext())
        {
            parameterMap.put(columnNameEnumIterator.next().getValue(), filterValueIterator.next());
        }
6. Pair<String, String> to return two values. A work around
7. CollectionUtils, MapUtils, StringUtils, Objects that has isNull and stuff? Prefer Spring CollectionUtils not ApacheCommons.
--------------------------------------------------------------------------------------------------------------
12-31-2019
1. If no access modifier is specified for the constructor of a normal class, the constructor has default access.
   If no access modifier is specified for the constructor of an enum type, the constructor is private.
   It is a compile-time error if the constructor of an enum type (§8.9) is declared public or protected.
2. SELECT strt_dt startDate, cat_rprtr_id catReporterId ........................... Aliases   
3. Stream.of("abc", "def").collect(Collectors.toSet()) 
4. 	   ErrorSummaryResponse errorSummaryResponse = new ErrorSummaryResponse();
        ErrorSummaryDetails errorSummaryDetails = new ErrorSummaryDetails();
        errorSummaryResponse.setErrorSummaryDetails(errorSummaryDetails);
        errorSummaryDetails.setCatOrganizationId(errorSummaryRequest.getCatOrganizationId());
        errorSummaryDetails.setDate(date);
	ErrorSummaryDetails value is set before it has anything. This works. how?
5. restrictedCharacterList.stream().anyMatch(name::contains)
6. Collections.sort(list);
7. @Autowired
    private ResourceLoader resourceLoader;
8. ArgumentCaptor Mockito:
	 ArgumentCaptor<Integer> catOrganizationIdCaptor = ArgumentCaptor.forClass(Integer.class);
     ArgumentCaptor<DateTypeEnum> dateTypeEnumCaptor = ArgumentCaptor.forClass(DateTypeEnum.class);
	 when(errorSummaryDao.getErrorSummaryDetails(catOrganizationIdCaptor.capture(), dateTypeEnumCaptor.capture())).thenReturn(Arrays.asList(errorSummaryDetail));
	-> Whenever it is called when running the test, the value passed at those positions are captured which could later be used to assert.
9. verify(herdDao, never()).getExpectedPartitionValues(any(), any());
10. Instant currentDateInstant = currentDate.atStartOfDay(ZoneId.of(JSON_TIMESTAMP_TIMEZONE)).toInstant();
	currentDateInstant = currentDateInstant.minus(1, ChronoUnit.DAYS);
11. @Autowire any classes that are defined as @components, like helper classes. = new HelperClass() does not work
12.  public final static List<String> ORGANIZATION_TYPES = Collections.unmodifiableList(Arrays.asList("FIRM", "OTHER"));
13. StoredProcedure, views in database
14. ctrl + shift + alt + j, find and replace in intelliJ
	ctrl + r -> open a find and replace dialogue
	Ctrl + Alt + Shift + V -> paste in intelliJ as is without escaping
15. Can't create filename starting with . for example .properties. Create a file. Then from cmd line do ren oldfilename .newfilename
16. ImmutableSet.of().........	
	Collections.unmodifiableList()............
---------------------------------------------------------------------------------------------------------
12-27-2019
1.    mockMvc.perform(post("/api/v1/errorSummary/").contentType(MediaType.APPLICATION_JSON).content(JsonUtils.marshal(errorSummaryPostRequest)))
            .andExpect(status().isInternalServerError()).andExpect(jsonPath("$.message").value("Invalid productType")).
        andReturn();
   ->	.message is a field in the response:
	{
		"statusCode": 500,
		"statusDescription": "Internal Server Error",
		"message": "Invalid productType",
		"messageDetails": []
	}
2. Complex sql queries, better to use JDBC template instead of JPA. NamedParameterJdbcTemplate
3. EWS users are users with login Id and password. They are associated with a CRD.
	ISSO are internal users using single-sign-on. Catdc team for example. Only add security access for services that they request for
--------------------------------------------------------------------------------------------
12-20-2019
Questions for Balaji about POST API to get errorSummary:
1. What are rowGroupCols, groupKeys and pivotMode? *** we aren't using pivotMode. Others are for grouping
2. How do multiple values for sortModel work?
3. Same way, how do multiple values for searchAfter work?
4. In response, Where should the columns that fit our use case go?  Inside data? ***yep
5. What is status with failures? ***Failure, Talk to allen about it
6. secondaryColumnFields ? **** Not using it yet

pre-canned- dynamic report template?? DeveloperToolds
----------------------------------------------------------------------------------------------
12-16-2019
1. Kill a port: From the commandline
	netstat -ano | findstr 8080
	taskkill /pid 21424 /F
2. URI encoding, decoding. 
	2019-11-27T00:09:09.985-05:00, when this date is sent as String to the backand and if it has +05:00 instead, Timestamp format incorrect.
	Need to encode the the "+", which would be "%2B"
-----------------------------------------------------------------------------------------------------------------
12-12-2019
1. Reporter is the main firm that has a bunch of IMIDS. Reporter can create oso relationships with other firms.
	They can have those other firms act as a submitter in which they submit in behalf of the reporter.
	Next, submitter can give another thirdParty access to just view the orders submitted.
2. CRD vs ORGID. Firms has CRD, people have orgId. For example, JPMS lets say has CRD : 1234, any person working for JPMS will have orgId : 1234
3. Perspective Submitter meaning records where the logged in user is acting as submitter. 
----------------------------------------------------------------------------------------------------------
12-11-2019
1. json Validator:     https://jsonlint.com/
2. Using ObjectMapper to convert java object to String. Then to escape or unescape the string, use 	StringEscapeUtils.escapeJava(message);
3. Sql COALESCE function.
	example:     JPAQuery<Tuple> jpaQuery = new JPAQuery<DataFileStatusEntity>(entityManager)
					.select(dataFileStatusEntity.catReporterIndustryMemberId.coalesce(NULL_IMID_NAME) will set NULL_IMID_NAME if the value is null
4. When Pom.xml not found for buil-tools package, do mvn clean install in that package.
5. When got Caused by: java.io.FileNotFoundException: ./catdd-lambdas-0.3.0-SNAPSHOT.jar (No such file or directory) in Jenkins while deploying,
	Probably the defined line is missing somewhere in the cm files...
--------------------------------------------------------------------------------------------------------------------
12-10-2019
RELEASE: 0.3.0 example
1. Cut the release branch, and update the pom version for current development to currentRelease+1
2. Update the fip image tag and apache tag for API(.dict and Dockerfile), UI(.dict and Dockerfile),
	and infrastructure -> external: app.groovy(amiId, apache_image) AND
						  internal: alb-ecs-ews(app.groovy: imageId),
						            alb-ecs-isso(app.groovy: imageId))
							
-------------------------------------------------------------------------------------------
12-09-2019
1. Adding retry without using any frameork: Need to add a class for Retry. Like below:
	package org.finra.catdd.lambda.retry;

	import java.util.function.Supplier;

	import org.slf4j.Logger;
	import org.slf4j.LoggerFactory;

	/**
	 * Class with retry methods to external call from lambda
	 *
	 * @param <T>
	 */
	public class Retry<T>
	{
		private static final Logger LOGGER = LoggerFactory.getLogger(Retry.class);

		private int maxRetries;

		private int retryCounter;

		public Retry(int maxRetries)
		{
			this.maxRetries = maxRetries;
		}

		// Takes a function and executes it, if fails, passes the function to the retry command
		public T run(Supplier<T> function)
		{
			try
			{
				return function.get();
			}
			catch (Exception e)
			{
				return retry(function);
			}
		}

		public int getRetryCounter()
		{
			return retryCounter;
		}

		private T retry(Supplier<T> function) throws RuntimeException
		{
			LOGGER.error("FAILED - call failed, will be retried " + maxRetries + " times.");
			retryCounter = 1;
			while (retryCounter <= maxRetries)
			{
				try
				{
					Thread.sleep(2000 * retryCounter);
					return function.get();
				}
				catch (Exception ex)
				{
					LOGGER.error("FAILED - failed on retry " + retryCounter + " of " + maxRetries + ", error: " + ex);
					if (retryCounter >= maxRetries)
					{
						LOGGER.error("Max retries exceeded.");
						break;
					}
					retryCounter++;
				}
			}
			throw new RuntimeException("Call failed on all of " + maxRetries + " retries");
		}
	}

2. Then wherever we need to use it we can add for example the following:
	        Retry<String> retryCredStash = new Retry<>(Integer.valueOf(propertyUtility.getProperty(MAX_RETRIES)));
		    password = retryCredStash.run(() -> CredStashUtils.getSecret(username));
3. But doing it the above way, we need to add retry to every call to the CredstashUtils. Thus by moving the retry to CredstashUtils itself, we make it more efficient. Example:
	     credPassword = retryCredStash.run(() -> {
            try
            {
                return jCredStashFX
                    .getCredential(credentialName, propertyUtility.getProperty(AGS_PROPERTY_NAME), propertyUtility.getProperty(ENVIRONMENT_PROPERTY_NAME), null,
                        null);
            }
            catch (Exception e)
            {
                LOGGER.error(String.format("Cannot load the password for the credential %s", credentialName));
                throw new CatddRuntimeException(e);
            }
        });

---------------------------------------------------------------------------------------------------------------
12-06-2019
1. In order to make a test where we expect a certain attibute to not be present in BusinessObjectData, we can remove it from the List<Attribute> using index.
	And if we want to alter the value of attribute, we can always set the value fo attribute manually.
2. Generic type <T> shouldnt be used with Objects. Instead for specific types like String, ClassName
----------------------------------------------------------------------------------------------------------------------
12-04-2019
Automation:(RestAssured)
1. 	@ParameterizedTest annotation is for tests that accepts parameters from a method using annotation @MethodSource("usersRoles").
	The method is something like 	public static Stream<Role> usersRoles() {return DataProviders.ewsAccountUsersRole();}
2. We could use Map<String, Object> queryParam = new HashMap<>();
				queryParam.put(QueryParams.CAT_ORGANIZATION_ID.getValue(), role.getOrgId()); to add the queries params.
3. a) make a dao class that we reads from DB which we compare the actual api called results against.
   b) A package for the test. Like Feedback. Which has FeedbackBuiler, FeedbackHelper and A function package that has actions(that has method to call the Api),
     out(what the ValueObjects class would be converted to), valueObjects(like DTO methods that has expected api response payload).
   c) Tests -> The actual test class where we compare results from DB call and the actual API call.
   d) Note: Remember to specify what environment we want to run the test against in local -> appEnv=dev
4.  Lombok annotations: @AllArgsConstructor, @Getter, @ToString, @EqualsAndHashCode, @Builder, @JsonIgnoreProperties(ignoreUnknown = true)

-----------------------------------------------------------------------------------------------------------------
11-26-2019
1. Canonical Metamodel JPA Queries. Example AtsOrderTypeEntity_ . Underscore at the end. hibernate-jpamodelgen
2. During Blue/Green deployment, the inflight request will be completed in the old blue. For example, starting a 1GB file upload right before the switch
	should finish it in the old-blue even after the switch is made. It was a time-out period though. like 15 minutes for example.
	The load balancer is smart enough to let the request that is already in progress to finish in the same stack.
	New requests should be routed to the green stack immediately after the switch.
3. From lambda -> Functions -> LambdaName -> Monitoring -> ViewLogsInCloudwatch -> type:text -> MessageId
	To see the sqs message for the lambda file executed.
4. Converting a given Date as String to Timestamp.     
		    ZonedDateTime zonedDateTimeFromSQS = ZonedDateTime.parse(herdBusinessObjectDataStatusChangeEvent.getEventDate());
            ZonedDateTime EasternZonedDateTime = zonedDateTimeFromSQS.withZoneSameInstant(ZoneId.of("America/New_York"));
            feedback.setGeneratedTimestamp(Timestamp.valueOf(EasternZonedDateTime.toLocalDateTime()));
5. In order to compareTo override for arrays, do the following.
	Boolean.valueOf(Arrays.equals(array1, that.array1)).compareTo(true); This works but the following doesn't:
	Arrays.equals(array1, that.array1).compareTo(true) because Boolean.valueOf has compareTo method.
6. Converting list to array:
	    FeedbackFileDetailOutput[] feedbackFileDetailOutputs = new FeedbackFileDetailOutput[feedbackFileDetailOutputList.size()];
        feedbackFileDetailOutputs = feedbackFileDetailOutputList.toArray(feedbackFileDetailOutputs);
7. ctrl + shift + N -> to find inside the project
8. om.fasterxml.jackson.databind.exc.InvalidFormatException: Can not deserialize value of type java.sql.Timestamp from String"2017-04-12 17:04:42.8966":
	not a valid representation. Cannot deserialize Cannot parse date while it seems to fit:
	Set     @JsonFormat(shape = JsonFormat.Shape.STRING, pattern = "yyyy-MM-dd HH:mm:ss", timezone = "America/New_York") for required format.
9. See what type a variable is : a.getClass().getName() where a is the variable
10. If date is received in String, we can easily use any Formatter to format into any Date. private final String feedbackTimestamp;
11. java Clock
12. Timestamp now = Timestamp.valueOf(LocalDateTime.now(ZoneId.of(EASTERN_TIMEZONE)));
13. sort:
	private final List<FileStatusDetailOutput> fileStatusDetailOutputs;
	fileStatusDetailOutputs.sort(Comparator.comparing(FileStatusDetailOutput::getUploadedFileName));
14.	public class EmployeeComparator implements Comparator<Employee> 
	{ 
		@Override
		public int compare(Employee o1, Employee o2) {
			return new CompareToBuilder()
					.append(o1.getJobTitle(), o2.getJobTitle())
					.append(o1.getAge(), o2.getAge())
					.append(o1.getSalary(), o2.getSalary()).toComparison();
		}
	}
	Collections.sort(listEmployees, new EmployeeComparator());
-----------------------------------------------------------------------------------
11-22-2019
1. In spring, CollectionUtils.isEmpty(empList) is null safe, unlike empList.isEmpty()
2. Optional .get() gives java.util.NoSuchElementException when Optional.empty()
3. Use businessObjectFormat from herd(swagger) to get the partition key
4. finally block is executed before return in try
5. we can put the cache initialization in static block instead of constructor if multiple times the object has to be created for the CacheHelper.
	Creating multiple objects of the CacheManager does not help in caching.
	public class CacheHelper
	{
		private static CacheManager cacheManager;
		private static Cache<String , ArrayList> listCache;

		static
		{
			System.out.println("I am inside static block ********************");
			cacheManager = CacheManagerBuilder.newCacheManagerBuilder().build();
			cacheManager.init();

			listCache = cacheManager.createCache("list", CacheConfigurationBuilder
				.newCacheConfigurationBuilder(String.class, ArrayList.class, ResourcePoolsBuilder.heap(10)));
		}
		
	//    public CacheHelper() {
	//        cacheManager = CacheManagerBuilder.newCacheManagerBuilder().build();
	//        cacheManager.init();
	//
	//        listCache = cacheManager.createCache("list", CacheConfigurationBuilder
	//                .newCacheConfigurationBuilder(String.class, ArrayList.class, ResourcePoolsBuilder.heap(10)));
	//    }

		public Cache<String, ArrayList> getListCache()
		{
			return listCache;
		}
	}
	
	public class ValuesCalc
	{
		private CacheHelper cache = new CacheHelper();
		private static String listCache = "listCache";

		public void getListOfValues() {
			System.out.println("***************"+cache.getListCache().containsKey(listCache));
			List list;
			if (cache.getListCache().containsKey(listCache)) {
				list=cache.getListCache().get(listCache);
			}
			else
			{
				System.out.println("Calculating list and caching result.");

				list = Arrays.asList("abc", "def", "ghi");
				ArrayList<String> arrayList = new ArrayList<String>(list);
				cache.getListCache().put(listCache, arrayList);
			}
		}
	}
6. Need to think about how it will work will multithreading whenever we use caching.
7. Always use Timestamp now = new Timestamp(DateTime.now().getMillis()); instead of new Date().getTime(); JODA time
	Or System.currentTimeMillis()
	With timezone: current timestamp . Didnt work for lambda
		private DateTimeZone zone = DateTimeZone.forID("America/New_York");
        Timestamp now = new Timestamp(new DateTime(zone).getMillis());

	The following works with lambda deployed. Gets the current time
	LocalDateTime now = LocalDateTime.now(ZoneId.of("America/New_York"));		Java time
	feedback.setCreatedOn(Timestamp.valueOf(now));
------------------------------------------------------------------------------------------------------------------------
11-21-2019
1. Flyway configuration/setup is already done for jenkins pipelines and stuff. So only need to update the flyway scripts.
   * V2019.4.3.04__create_fdbk_file_info.sql file for example.
   * Next script name it like V2019.4.3.07__create_fdbk_file_info.sql. Leave the gap for Alters and stuff incase we need to modify.
   * Place DDL commands related to one table together. For example, for file-submission-table, we need herd_info_table and status_lookup_table. Also,
	 Sequence for file-submission-table and herd_info_table. 
		
		--drop sequence if exists catdd_owner.fdbk_file_info_seq;
		--DROP TABLE if exists catdd_owner.fdbk_file_info;

		CREATE SEQUENCE if not exists catdd_owner.fdbk_file_info_seq
			INCREMENT 1
			START 1
			MINVALUE 1
			MAXVALUE 9223372036854775807
			CACHE 1;

		ALTER SEQUENCE catdd_owner.fdbk_file_info_seq
			OWNER TO catdd_owner;

		COMMENT ON SEQUENCE catdd_owner.fdbk_file_info_seq
			IS 'fdbk_file_info_seq id for each entry in table';

		GRANT ALL ON SEQUENCE catdd_owner.fdbk_file_info_seq TO catdd_owner;
		GRANT ALL ON SEQUENCE catdd_owner.fdbk_file_info_seq TO catdd_datafix_role;
		GRANT SELECT ON SEQUENCE catdd_owner.fdbk_file_info_seq TO catdd_read_role;



		CREATE TABLE if not exists catdd_owner.fdbk_file_info
		(
			file_id bigint         NOT NULL,
			file_nm                character varying(300),
			cat_rprtr_org_id       bigint,
			cat_sbmtr_id           bigint NOT NULL,
			sbmtr_3rd_prty         bigint,
			gend_ts                timestamp without time zone NOT NULL,
			prtn_value             character varying(100),
			buckt_nm               character varying(150) NOT NULL,
			file_key               character varying(300) NOT NULL,
			herd_info_id bigint    NOT NULL,
			crtd_ts                timestamp without time zone NOT NULL,
			crtd_by                character varying(50) NOT NULL,
			updtd_ts               timestamp without time zone NOT NULL,
			updtd_by               character varying(50) NOT NULL
		);

		ALTER TABLE catdd_owner.fdbk_file_info
			OWNER to catdd_owner;

		ALTER TABLE catdd_owner.fdbk_file_info
		  ADD CONSTRAINT herd_info_id_herd_info_lk FOREIGN KEY (herd_info_id)
		  REFERENCES catdd_owner.herd_info_lk (herd_info_id);

		GRANT ALL ON TABLE catdd_owner.fdbk_file_info TO catdd_owner;
		GRANT INSERT, SELECT, UPDATE, DELETE ON TABLE catdd_owner.fdbk_file_info TO catdd_datafix_role;
		GRANT SELECT ON TABLE catdd_owner.fdbk_file_info TO catdd_read_role;
	*Sometimes we add the constraints like foreign key later after creating tables instead of while creating is to make sure all the tables are created first.
   
2. To try in local, download flyway. Place the required jar for databases into jars folder. In the flyway.conf inside conf folder, we can set the flyway-username,
	flyway-password, flyway-url and flyway-driver as follows:
  flyway.driver=org.postgresql.Driver
  flyway.url=jdbc:postgresql://localhost:5432/
  flyway.user=postgres
  flyway.password=postgres
3. Install postgreSql. Install PgAdmin. Create a database. Use those details in the flyway.config
4. If we get java.lang.IllegalStateException: Failed to execute CommandLineRunner while deploying to an environment from jenkins, 
	we can troubleshoot by going to cloudformation in aws, then to events. The stack can be found in the console: CATDD-provision-target-CATDD-api-ews-DEV-01
5. We put logger for implemtion class, not he extending interface. Like ......getLogger(ServiceImpl.class) instead of extending interface
-------------------------------------------------------------------------------------------------------------
11-18-2019
1. Use QueryDsl instead of CriteriaBuilder.
2. In aws lambda page, there is a Concurrency tab where we can reserve concurreny. Maximum number of concurent execution of lambda can be set from there.
	Since the lambda we have is just java code where there is no way to set the maximum concurreny like Spring. In spring. we can set the properties in 
	application.yml, spring datasource.tomcat.max-active=200. which will initially set 200 concurrent connections in connection pool. 
3. The lambda function is deployed in a specefic environment in jenkins, which will create a lambda function in aws. We could go to the lambda in aws, and	
	create an event to test. We could test the lambda.
	{
    "Records": [
        {
            "messageId": "059f36b4-87a3-44ab-83d2-661975830a7d",
            "receiptHandle": "AQEBwJnKyrHigUMZj6rYigCgxlaS3SLy0a...",
            "body": "{\n          \"Type\" : \"Notification\",\n          \"MessageId\" : \"3d9c82bc-227b-5e0f-81e1-d4ad8ee1f8d8\",\n          \"TopicArn\" : \"arn:aws:sns:us-east-1:474848416659:ESMP-X-I-CATDM-HERD-NOTIFICATIONS\",\n          \"Message\" : \"{\\n \\\"eventDate\\\" : \\\"2019-10-04T16:23:54.818-04:00\\\",\\n \\\"businessObjectDataKey\\\" : {\\n \\\"namespace\\\" : \\\"IndustryMember\\\",\\n \\\"businessObjectDefinitionName\\\" : \\\"ORDER_EVENTS\\\",\\n \\\"businessObjectFormatUsage\\\" : \\\"INT\\\",\\n \\\"businessObjectFormatFileType\\\" : \\\"TXT\\\",\\n \\\"businessObjectFormatVersion\\\" : 0,\\n \\\"partitionValue\\\" : \\\"9_OAKF_20190925_testFilePair_OrderEvents_441378\\\" \\n },\\n \\\"newBusinessObjectDataStatus\\\" : \\\"VALID\\\"\\n }\\n\",\n          \"Timestamp\" : \"2019-10-04T20:23:54.979Z\",\n          \"SignatureVersion\" : \"1\",\n          \"Signature\" : \"klkYdNHkOZRlMyBY/yukz/O9RJ9VxCtJSPV5EFSMUAcJKt9m+RBrnTLBbOqVpZYi4l0/Lcsnx/BJglM/PRYfbh566KkjETl+wm1thetQaLx1kgMBZdHIY5oT9AUhMXehzk4bQZeVv0L+lb5qwhI44UER8pUd+2qfNEyszoBEjDau/Vx75FMrtQSnPUXGhJu7PnQAeqMgMGlfxNGviunf1nNktm4Uex6UfHppCkh6zysAgf9CEowZzLvjKGwi5pRNDY3hjN90JRmHxhGnBG5MQQT2MyqgqB/TTKg6z15JX6QgVbilqylWCcilHOYPZxwiBGUZFpv/SimFFc95VRz3EA==\",\n          \"SigningCertURL\" : \"https://sns.us-east-1.amazonaws.com/SimpleNotificationService-6aad65c2f9911b05cd53efda11f913f9.pem\",\n          \"UnsubscribeURL\" : \"https://sns.us-east-1.amazonaws.com/?Action=Unsubscribe&SubscriptionArn=arn:aws:sns:us-east-1:474848416659:ESMP-X-I-CATDM-HERD-NOTIFICATIONS:3e32ad9f-a2e6-4a7e-90ac-7019daf10d4f\"\n          \n      }",
            "attributes": {
                "ApproximateReceiveCount": "1",
                "SentTimestamp": "1545082649183",
                "SenderId": "AIDAIENQZJOLO23YVJ4VO",
                "ApproximateFirstReceiveTimestamp": "1545082649185"
            },
            "messageAttributes": {},
            "md5OfBody": "098f6bcd4621d373cade4e832627b4f6",
            "eventSource": "aws:sqs",
            "eventSourceARN": "arn:aws:sqs:us-east-2:123456789012:my-queue",
            "awsRegion": "us-east-2"
        }
        
        ]
	}
	We only need to update the body with stuff like namespace, businessObjectDefinitionName, formatUsage, fileType,businessObjectFormatVersion, partitionValue.	
	Remember not to provide businessObjectDataVersion, as this is retrieved from herd, the latest one.
4. HikariCP vs TomcatCP
5. Assert.hasText(perspectives, "The perspective value can not be empty.");
6.  long diffInMillies = Math.abs(endDate.getTime() - startDate.getTime());
        long diff = TimeUnit.DAYS.convert(diffInMillies, TimeUnit.MILLISECONDS);
7. file name validation regex: for file upload
	^[0-9]+_[a-zA-Z0-9]{0,7}_([12]\d{3}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01]))(_[a-zA-Z0-9]{0,20})?_[a-zA-Z0-9]{0,20}_[0-9]{6}(\.[a-zA-Z]{3,4})?\.[a-zA-Z]{3,4}\.[a-zA-Z0-9]{3,4}$
	-> ([12]\d{3}(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])) -> Date regex. First part year _ _ _ _ could be starting with 1 or 2 and any other two.
		Then for Month _ _ could be 01,02.....09 OR 10,11,12
		Then for Date _ _ could be 01, 02....09 OR 11,12....,21....29 OR 30,31
	-> a{0,7} -> a could repeat 0 to 7 times
	-> a+ -> a could appear one or more times
	-> a* -> a could appear zero or more times
	-> a? -> a could repeat zero or one time
----------------------------------------------------------------------------------------------------
11-13-2019
1. Deploy ECS-EWS.......
	Verification: 1. Login to AWS using MFA with  Account: finra-catct (327598677452) -> Go to ECS ->  Filter list as "catdd" ->  Select CATDD-INTERNAL-EWS
		 -> Select tab ECS-Instances -> Select an EC2 instance from ec2 column -> Verify the AMI id.   New AMI id = ami-05495984236abcc35, old=ami-0676b362a8f8e5829
2. Deploy API-EWS job.....
	Verification: 1. Run health check 
				  2. Run the Build info. Build info should have version as SNAPSHOT 0.2.0, old was 0.1.0
3. Deploy UI job.....
	Verification: 1. Run health check
				  2. Login to AWS using MFA with  Account: finra-catct (327598677452) -> Go to ECS ->  Filter list as "catdd" ->  Select CATDD-INTERNAL-EWS
				  -> Select the service name catdd-svc-ui-ews-c-01 -> Go to Events tab -> See something like "catdd-svc-ui-ews-c-01 registered 3 targets in 
					 target-group tg-catdd-ui-ews-ct-01"
4. Deploy Bastion/External stack......
	For ext_ecs: Check the ec2 ami as below:
	Verification: 1. Login to AWS using MFA with  Account: finra-catct (327598677452) -> Go to ECS ->  Filter list as "catdd" ->  Select CATDD-EXT
		 -> Select tab ECS-Instances -> Select an EC2 instance from ec2 column -> Verify the AMI id.   New AMI id = ami-05495984236abcc35, old=ami-0676b362a8f8e5829
				  2. Verify by logging in to reporterPortal for UI AND by hitting currentUser endpoint for API
	For bastion: let CM verify		 
	
	----------------------------------------------------------------
 Link to:
	
	Docker images:
	https://wiki.finra.org/display/CloudServices/10-October+2019+FINRA+Docker+Images

	AMI:
	https://wiki.finra.org/display/CloudServices/AMI+Releases
--------------------------------------------------------------------------------------------------
11-12-2019

	catdd-api-ews		release 0.2.0 -> dev-int, qa, qa-int, qa-stress
						develop -> dev

	catdd-api-isso		release 0.2.0 -> dev-int, qa, qa-int, qa-stress
						develop -> dev

	catdd-ui-ews		release 0.2.0 -> dev-int, qa, qa-int, qa-stress
						develop -> dev

	ecs-ews				develop -> dev

	catdd-external -> bastion	develop -> dev

	Deploy isso-dev-int and isso-qa-int later after letting CAT-DC team know since they are using it.
------------------------------------------------------------------------------------------
11-11-2019
1. findbugs: EI_EXPOSE_REP ....Usually happens when returning reference to a mutable object. Return a clone instead.
2. Mutable vs immutable objects
3. #Upgrade the AMI.
4. #New Wiki will be 0.2.1
5. #Mostly from 0.1.1
6. group by
7. Need a config file in .aws in root folder for s3 location and stuff:
	[default]
	region=us-east-1
	output=json
	role_arn=arn:aws:iam::474848416659:role/APP_CATDD
8. Need to add a ignore unknown property if using Jackson in order to ignore the fields in the api payload that the other team might keep adding on.
	objectMapper.configure(DeserializationConfig.Feature.FAIL_ON_UNKNOWN_PROPERTIES, false);
9. Convert a String to Timestamp with a certain format:
	    private DateTimeFormatter formatter = DateTimeFormat.forPattern("yyyy-MM-dd'T'HH:mm:ss.SSSZZ");
		String time = "2019-11-05T17:47:58.995-05:00"
		new Timestamp(formatter.parseDateTime(time).getMillis())
10. Timestamp now = new Timestamp(new Date().getTime());
11. ID Gateway Base Image in the docker images page is the fip image
12. We only deploy to Dev environment features or develop branch. Release branch we deploy in all other environments.
13. Always do Stack-update for infrastructure, and Fresh for the application, when it comes to COMMAND_ENV.
14. NO ISSO at all in this release.....Add ews ecs....hopefully. and bastion
15. Transaction Management. We only need one commit(). Always close resources
16. Need to deploy ALB first, then ECS, then Bastion.
17. Always use Optional whenever there is a list of key:value. Avoids checking for name and value seperately.
	Instead of doing:
	 boolean isAttributePresent =
            businessObjectDataAttributesList.stream().anyMatch(attribute -> attribute.getName().equalsIgnoreCase(name));
	 if (isAttributePresent)
        {
            String attributeValue =
                businessObjectDataAttributesList.stream().filter(attribute -> attribute.getName().equalsIgnoreCase(name)).findAny().get().getValue();
            if (!StringUtils.isEmpty(attributeValue))
            {
                return attributeValue;
            }
		}
	Do the following:
	Optional<Attribute> optionalAttribute =
            businessObjectDataAttributesList.stream().filter(attribute -> attribute.getName().equalsIgnoreCase(name)).findFirst();
        return optionalAttribute.isPresent() ? optionalAttribute.get().getValue() : null;
18. Collections.EMPTY_LIST
19. preparedStatement = connection.prepareStatement(INSERT_HERD_QUERY, preparedStatement.RETURN_GENERATED_KEYS);
		ResultSet rs = preparedStatement.getGeneratedKeys();
		rs.next();
		//column index 1 returns the value of 1st column herd_info_id which is autogenerated during a record insertion
		return rs.getLong(1);
20. Jdbc query to insert a auto-generated id automatically:
	"INSERT INTO herd_info_lk (herd_info_id,actn_type,strg_name,name_space,bus_objct_dfntn,usage_cd," +
        "file_type,frmt_vrsn,prtn_key) VALUES (nextval('data_rfrsh_hs_seq'),?,?,?,?,?,?,?,?);";
21. Forward vs reverse proxy.
22. Do we need to close resultSet???? https://docs.oracle.com/javase/7/docs/api/java/sql/ResultSet.html	***Dont need to
23. Objects.nonNull(sqsAtributes) -> Checking for map null and others too
24. Never put integers like -1(C like code), or anything for a condition where something is null. Use Optional class. 
	Optional<Integer> herdInfoId = Optional.ofNullable(null);   ->  Integer herdInfoId = null;
	Optional.ofNullable(), Optional.of(), .get()
25. Seperate out logic for different things. Cleaner code.
26. Splunk will only have the Log messages. And exceptions for only 500 are logged. Meaning Logger.error(String.format("........", exception));
27. connection.rollback(). Replace connection.commit() with this inorder to just check but not commit to the db.
28. No-Op -> No operation
--------------------------------------------------------------------------------------
11-08-2019
1. Unit testing with a 2 server:
	@BeforeAll
    public static void init() throws SQLException
    {
        h2server = Server.createPgServer("-baseDir", getBaseDir(), "-pgPort", "5535", "-pgDaemon");
        LOGGER.info("Starting server");
        h2server.start();
        LOGGER.info(String.format("Server Started and is running on %s", h2server.getURL()));
        assert getPgJdbcDriver();
        connection = DriverManager.getConnection("jdbc:h2:~/test02", "sa", "");
        LOGGER.debug("Creating tables in H2");
        creatingTable(connection);
        LOGGER.debug("Tables are created");

    }
	private static void creatingTable(Connection connection) throws SQLException
    {
        Statement statement = connection.createStatement();
        String creatingFeedbackFileInfoTable =
            "CREATE TABLE IF NOT EXISTS feedback_file_info (file_id bigint NOT NULL, file_nm character varying(300) NOT NULL," +
                " cat_rprtr_org_id bigint, cat_sbmtr_id bigint NOT NULL, cat_thrd_prty_id bigint, gnrtd_ts timestamp NOT NULL," +
                " prtn_vl character varying(500) NOT NULL, bckt_nm character varying(150) NOT NULL, file_key character varying(300) NOT NULL," +
                " herd_info_id bigint NOT NULL, crtd_ts timestamp NOT NULL, crtd_by character varying(50) NOT NULL, updtd_ts timestamp NOT NULL," +
                " updtd_by character varying(50) NOT NULL);";
        statement.execute(creatingFeedbackFileInfoTable);

        String creatingHerdInfoTable =
            "CREATE TABLE IF NOT EXISTS herd_info_lk (herd_info_id smallint NOT NULL, actn_type character varying(50) NOT NULL," +
                " strg_name character varying(50) NOT NULL, name_space character varying(50) NOT NULL,bus_objct_dfntn character varying(50) NOT NULL," +
                "usage_cd character varying(50) NOT NULL, file_type character varying(50) NOT NULL, frmt_vrsn integer NOT NULL," +
                " prtn_key character varying(50) NOT NULL);";
        statement.execute(creatingHerdInfoTable);
        String creatingRefreshSequence = "CREATE SEQUENCE IF NOT EXISTS DATA_RFRSH_HS_SEQ;";
        statement.execute(creatingRefreshSequence);
        String creatingRefreshSequence2 = "CREATE SEQUENCE IF NOT EXISTS OSO_RLTNP_HS_SEQ;";
        statement.execute(creatingRefreshSequence2);
        statement.close();
    }
	
	@AfterAll
    public static void closeConnection() throws SQLException
    {
        LOGGER.info("Stopping The Server");
        DataBaseUtils.releaseConnection(connection);
        if (h2server.isRunning(true))
        {
            h2server.stop();
        }
    }
2. In order to add a custom banner in spring application startup. Add a banner.txt file in resources folder with the custom banner....Can add Ascii arts 
     _ _ __    _____      __    ________     |\---/|                  ______   ______     __ _ _   
    / / / /   // ___|    // \   ||_   _|     | ,_, |                   ||  _ \  ||  _ \   \ \ \ \    
   / / / /   || |       //   \    || |        \_`_/-..----.            || | | | || | | |   \ \ \ \                 
  ( ( ( (    || |      //  -  \   || |     ___/ `   ' ,""+ \           || | | | || | | |    ) ) ) )              
   \ \ \ \   || |___  //  ___  \  || |    (__...'   __\    |`.___.';   || |_| | || |_| |   / / / /             
    \_\_\_\   \\____|//__/   \__\ ||_|     (_,...'(_,.`__)/'.....+*   _||____/ _||____/   /_/_/_/
	
3. 	pmd:check			-> PMD

	findbugs:check		-> Findbugs

	clover:clean clover:instrument clover:aggregate clover:clover	-> Clover coverage

	checkstyle:check	-> Checkstyle

	clean install	-> Mvn clean install
-------------------------------------------------------------------------------------------------------
11-06-2019
1. When using mapper from jackson ObjectMapper, setting another object in a string causes issues.
	example: "message":"{
				"eventDate" : " 2019-11-05T17:47:58.995-05:00 ",
				"businessObjectDataKey" : {
					"namespace" : "CATRD", 
					"businessObjectDefinitionName" : "MSTR_MBR_DICT_HS",
					} ,
				"newBusinessObjectDataStatus" : "VALID",
				}"
	when mapping to a class that takes message as string. it considers "{" part as a value to the message and skips the rest of the "...."
	Thus we can use other approaches. like Jackson library, or JSON-java.
	Example of Jaskson: Map<String, Object> params = new HashMap<>();
						params.put("message", "{\"eventDate\" : \"2019-11-05T17:47:58.995-05:00\"}");
						String payload = new ObjectMapper().writeValueAsString(params);
2. Amazon S3/4748-4841-6659-catdm-devint/catrd     /cat   /prc         /txt        /mstr-mbr-dict-hs     /schm-v0       /data-v0      /trade-dt=2017-09-18
				BUCKET					/namespace/		 /FormatUsage /FormatType /	BusinessObjectName	/SchemaVersion / DataVersion / PartitionValue
3. No need to provide businessObjectDataVersion, it takes the latest....And many conversions from herd to s3 like order_events to order-events happens. So always use
	the names(namespace, formatType etc) from herd.
4. #Come up with custom CATDD name for Spring boot application startup....
5.  Calling the lambda handler with SQS message from a main method.
	public static void main(String[] args) throws JsonProcessingException
    {
        HerdNotificationHandler herdNotificationHandler = new HerdNotificationHandler();
        SQSEvent sqsEvent = new SQSEvent();
        SQSEvent.SQSMessage sqsMessage = new SQSEvent.SQSMessage();
        List<SQSEvent.SQSMessage> sqsMessageList = new ArrayList<>();

        Map<String, Object> params = new HashMap<>();
		
        //SQS Payload for feedback metadata
        params.put("message",
            "{\"businessObjectDataKey\" : {\"namespace\" : \"IndustryMember\", \"businessObjectDefinitionName\" : \"ORDER_EVENTS\",\"businessObjectFormatUsage\" : \"INT\",\"businessObjectFormatFileType\" : \"TXT\",\"businessObjectFormatVersion\" : 0,\"partitionValue\" : \"9_OAKF_20190925_testFilePair_OrderEvents_441378\" } ,\"newBusinessObjectDataStatus\" : \"VALID\",\"oldBusinessObjectDataStatus\" : \"PROCESSING\"}");
        String payload = new ObjectMapper().writeValueAsString(params);


        //SQS Payload for masterMemberDictionary
        params.put("message",
            "{\"eventDate\" : \" 2019-11-05T17:47:58.995-05:00 \",\"businessObjectDataKey\" : {\"namespace\" : \"CATRD\", \"businessObjectDefinitionName\" : \"MSTR_MBR_DICT_HS\",\"businessObjectFormatUsage\" : \"PRC\",\"businessObjectFormatFileType\" : \"TXT\",\"businessObjectFormatVersion\" : 0,\"partitionValue\" : \"2019-04-20\",\"businessObjectDataVersion\" : 1 } ,\"newBusinessObjectDataStatus\" : \"VALID\",\"oldBusinessObjectDataStatus\" : \"PROCESSING\"}");
        String payload = new ObjectMapper().writeValueAsString(params);

        sqsMessage.setBody(payload);
        sqsMessageList.add(sqsMessage);
        sqsEvent.setRecords(sqsMessageList);

        herdNotificationHandler.handleRequest(sqsEvent, null);
    }
}
6. If the request made it to the server, it would always return JSON response
7. #Caused by: org.postgresql.util.PSQLException: ERROR: duplicate key value violates unique constraint "herd_info_lk_actn_type_key"
  Detail: Key (actn_type)=(FEEDBACK) already exists.
8. h2server = Server.createPgServer("-baseDir", getBaseDir(), "-pgPort", "5535", "-pgDaemon");
9. pg_dump -U postgres -s catdd_owner > C:\Users\k28172\mySchema.sql   Command for commandline to dump the schema and table create details intoa file
10.  if(StringUtils.isEmpty(record.getFileName()))
                {
                    preparedStatement.setNull(++position, Types.VARCHAR);
                }
                else
                {
                    preparedStatement.setString(++position, record.getFileName());
                }
	Instead of doing like above for null check, do the following. setObject(index, object, type) 
    preparedStatement.setObject(++position, feedback.getSubPartitionValue(), Types.VARCHAR);

11. CATRAO -> CAT RIM and OPS team. Not a different application.
12. MFA signin aws: https://adfs-mfa.finra.org/adfs/ls/idpinitiatedsignon.htm?loginToRp=urn:amazon:webservices
	login id: k28172@corp.root.nasd.com
	password: ***********************
	Then RSA token
13. JAMS client
14. For something that is created and used only once, use constructor.
	For example, the handler for Lambda function, when handler is triggered, in the AWS when the object is created, the constructor creates the object of Map<enum, sqsMessageProcessor> once and reuses it.
15. We never provide businessObjectDataVersion. We get the latest from business object data herd dm.
16. Start logging more often in order to track it.
17. findById() spring data respository returns Optional.
------------------------------------------------------------------------------------------------------------
11-04-2019
1. Be mindful when changing the structure for response payload as other teams might be using the api. We can always add more field to the response but
	not change the structure itself.
2. Arrays.stream(ewsHeaderValueArray).parallel().anyMatch(headerEntry.getValue()::equalsIgnoreCase
		Arrays.stream(HEADER_VALUES).parallel().anyMatch(headerEntry.getValue()::contains))
			For Array.
	For List, ewsHeaderValueList.parallelStream().anyMatch(valueToMatch::contains)
	
	In order to combine two methods for stream:
	Arrays.stream(feedbackObjectDefinitionNameArray).anyMatch(objectDefinitionName -> objectDefinitionName.trim().equalsIgnoreCase(businessObjectDefinitionFromSqs)) 
3.   ewsHeaderValue: use,use-read,use-read-grant,read-grant,read  .    Application.yml for array of values. Read in java, @Value("${security.ewsHeaderValue:use}")
																														private String[] ewsHeaderValue;
4. ArrayUtils.isEmpty(), StringUtils.isEmpty()   Apache commons lang3
5. In order to use reflectionTestUtils for a list, set a list as 
	    public static final List<String> ENTITLEMENT_VALUE_LIST = Arrays.asList("use", "use-read", "use-read-grant", "read-grant", "read");
	the use that in the values. eg.   ReflectionTestUtils.setField(httpHeaderApplicationUserBuilder, "ewsHeaderValue", ENTITLEMENT_VALUE_LIST);
6. ClassLoaders java. System ClassLoader, Extension ClassLoader and bootstrap ClassLoader:
		private static PropertyUtility propertyUtility = new PropertyUtility();
	            properties.load(PropertyUtility.class.getClassLoader().getResourceAsStream(env + ".properties"));
		-> Loads properties from whatever environment it is on. example, dev.properties

7. Where is import org.finra.catdd.catco.model.entity.QDataFileStatusEntity; ???? Its a autogenerated entity which will be inside of target/generated-sources/java/entity
	Do mvn clean install to get it from the configuration in intelliJ, not the command line. DO in the specific package that is missing the import
    Add trim maybe....
8. Do mvn clean in /code; to get rid of the error CreateProcess error=206, The filename or extension is too long
9. Bean method 'buildProperties' in 'ProjectInfoAutoConfiguration' not loaded because @ConditionalOnResource did not find resource
	'${spring.info.build.location:classpath:META-INF/build-info.properties}'.
	Solve the above by doing mvn clean install in /code
10. when finbugs is not working, file name too long problem, do mvn clean.

--------------------------------------------------------------------------------------
10-30-2019
1. The diamond problem
2. Multiple data source spring
3. # Why do methods getCurrentUser run at first when I make a get call for oso. And why does it run 3 times?????
4.    // convenience method to provide a mapping for list of ews Organizations to a map with key as orgId, and value as orgName
    default Map<Integer, String> ewsOrganizationMap() {
        return findByCustomOrgTypesAndSubtypes(CatddConstants.ORGANIZATION_TYPES, CatddConstants.ORGANIZATION_SUBTYPE_TO_EXCLUDE).stream().collect(
            Collectors.toMap(EwsOrganizationEntity::getOrganizationId, EwsOrganizationEntity::getOrganizationName));
    }
	Method inside the repository to convert the ewsOrganizationList to map.
	
5. #What if no name for the organization in the db? should it return null??? ******Set a log message 
6. Can we set logger in a DTO class ? Ya if we need to. But better to have a common method somewhere in a common class and call that instead ***
7. Use verb for method name;
8. You dont need to add javadoc in the implementation class if javadoc is already available in the interface
9. Interface methods are public by default
10. In order to check for ISSO user, we need two headers. userprincipalname and memberof, where memberof=CN=ISSO_CATDD_D,
	We need to update the application.yml file for ISSO user where we need to change the regex, headernames to match that of the isso_dev.dict.
		Then add the security roles of ISSO_CATDD_D to allow them to access certain endpoints like FN_OSO_RELATIONSHIP_GET
		And useEwsAuthentication: false in security:
----------------------------------------------------------------------------------------------------
10-29-2019
1. #Add @Cacheable in DAO method instead of service layer for clean seperation	****
2. #Cache credstash too because multiple calls to get the same user password.. Retry for Credstash ???
3. #Add Spring retry for file upload
4. #Cache ews org id for submitter, third_party and org_id name story so that we dont make expensive calls for every record.		****
5. Java stream Api.....Method reference does not provide a way to pass multiple arguments... so we can use lambda expression
    osoRelationshipDetails.setOsoRelationshipDetails(osoRelationshipList.stream().map(OsoRelationshipDetail::new).collect(Collectors.toList()));
	Note- ::new sends a osoRelationshipEntity from osoRelationshipList
																VS
	osoRelationshipDetails.setOsoRelationshipDetails(
            osoRelationshipList.stream().map((osoRelationshipEntity) -> new OsoRelationshipDetail(osoRelationshipEntity, ewsOrganizationDetailList))
                .collect(Collectors.toList()));
				
	osoRelationshipResponse.setCatReporterOrganizationName(ewsOrganizationEntityList.stream().filter(ewsOrganizationDetail
         -> ewsOrganizationDetail.getOrganizationId().equals(osoRelationshipEntity.getCatReporterOrganizationId())).
            findAny().orElseThrow(() -> new IllegalArgumentException("Not found any")).getOrganizationName());
				
	The above search will be really expensive because of one hundred thousand records. 
	Its best to retrive from the database as a list. Then in an implementation or any method. Convert it into a map. Then find the value, based on the key.
	Map<Integer, String> ewsOrganizationMap =
            ewsOrganizationEntityList.stream().collect(Collectors.toMap(EwsOrganizationEntity::getOrganizationId, EwsOrganizationEntity::getOrganizationName));
			
6. We can use @Cacheable for caching in the DAO layer methods instead of the service layer methods...
7. Jackson ignore unknown properties: Catdc team should have it in their code to ignore unknown properties. Refer to Lambda code javaUtils
	 // ignore unknown properties.
        mapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES, false);
        mapper.configure(MapperFeature.ACCEPT_CASE_INSENSITIVE_PROPERTIES, true);
8. what name shows as response for DTO depends on on the Class name but the object of it that we create. So Depending on the object name is what we get in response 
	payload.
9. Its very expensive to loop through a list to find a match. Always use hashset.
-------------------------------------------------------------------------------------------------------
10-24-2019
1. #Do we not need to add the headernames in .dict config files, and entitlement FN_FILE_UPLOAD
2. #why is userPrincipalName, orgId, and role required while cfirstname and others in headers are optional?
3. catdd-api-ews is the branch to deploy in dev
4. #Verify the bugfix worked ***
5. #I merged the code to develop without git pull all the changes from develop. But my changes were not a conflict. So it shouldnt be a problem. ****
6. #Update the wiki page	***
7. #See what branch is depolyed in QA
8. #james's update to file upload	***
9. JDBC for lambda function....addBatch()....
10. Jams vs cron job scheduler
-----------------------------------------------------------------------------------------------------
10-23-2019
1. @Rule
    public TemporaryFolder testFolder = new TemporaryFolder();                 Junit4
	
	File tempFolder = testFolder.newFolder("/tmp");

    @TempDir
    File temporaryFolder;														Junit5		
2. /temp for windows and /tmp for linux machines in the root folder.
	        ReflectionTestUtils.setField(fileUploadHelper, "fileRootFolderName", "/");
	give only "/" to create on the root. Platform independent
3. For return type null, use         doThrow(new Exception).when() instead of when().thenThrow();
4. @MockitoSettings(strictness = Strictness.LENIENT) -> class level
	    lenient().when(mockList.add("one")).thenReturn(true); -> method level

5. ###Push from controller the servletFileRequest object...
6. when we are mocking something and that is also being initialized inside the method as new Method(), the mock doesnot work.Because it always works with the new 
	object that is created. So we can create a @Bean of it and @Autowired.
7. ###See if ServletFileUploader is thread-safe. if it is safe, its okay to use the bean as default(singleton). or else we set it as prototype...Or other way is to
	send an object it from controller. So that for every call, there is a seperate object of it.
8. Whatever we @Autowired in the class we have to test, we have to mock it all in test class.
9. User user = currentUserService.getCurrentUserInfo().getUser();
	 To mock something like this use when(currentUserService.getCurrentUserInfo()).thenReturn(), 
10. we have a exception handler somewhere in the applicaition. If we have throws for exceptions, later at the end it gets handled from there. We could add
	more exceptions to it.
11. #Add the Timestamp, add the junit test for helper
12. Joda time:
	DateTimeFormatter patternFormat = DateTimeFormat.forPattern("yyyy-MM-dd'T'HH:mm:ss.SSSZZ");
	String dateWithCertainFormat = patternFormat.print(new DateTime());
13. DateTimeFormat is thread-safe and immutable
14. Good practise to put the private static final Logger LOGGER = LogManager.getLogger(FileUploadHelper.class); first thing inside the class.
15. need to use AccessDeniedException from import org.springframework.security.access.AccessDeniedException;
     and not the java.nio.AccessDeniedException because it asks us to handle it

-----------------------------------------------------------------------------------------------------
10-22-2019
1. Do unit tests for service and controller, and helper class for file upload
2. Add requestHost in currentUser, and populate the requestHost field in fileSubmissionInformationEntity ****
	Update CurrentUserInfo, CurrentUserServiceImpl, ApplicationUser, HttpHeaderApplicationUserBuilder, the get it wherever you need
3. Change the configs, for ews_dev.dict, 
4.      final String fileName = "test.txt";
        final byte[] content = "Dummy content".getBytes();
        MockMultipartFile mockMultipartFile =
            new MockMultipartFile("content", fileName, "text/plain", content);
        MockMultipartHttpServletRequest req = new MockMultipartHttpServletRequest();
                req.addFile(mockMultipartFile);
        fileUploadHelper.validateMultipartContent(req);
        String message = assertDoesNotThrow(() -> DOES_NOT_THROW_EXCEPTION);
        assertEquals(DOES_NOT_THROW_EXCEPTION, message);
	@Test
    public void testValidateMultipartContent_withMultipartFile_success()
    {
        MockMultipartHttpServletRequest req = new MockMultipartHttpServletRequest();
        fileUploadHelper.validateMultipartContent(req);
        String message = assertDoesNotThrow(() -> DOES_NOT_THROW_EXCEPTION);
        assertEquals(DOES_NOT_THROW_EXCEPTION, message);
    }

    @Test
    public void testValidateMultipartContent_withNonMultipartFile_throwException()
    {
        HttpServletRequest req = Mockito.mock(HttpServletRequest.class);
        Exception thrown = assertThrows(RuntimeException.class, () -> fileUploadHelper.validateMultipartContent(req));
        assertTrue(thrown.getMessage().equals(CatddConstants.NON_MULTIPART_CONTENT));
    }
5. MockMultipartFile mockMultipartFile = new MockMultipartFile(fileName, stubInputStream);
   MockMultipartHttpServletRequest request = new MockMultipartHttpServletRequest();
   HttpServletRequest request = new MockHttpServletRequest();
6. We dont need to create a HttpServletRequest, then create fileItemIterator, thenFileIteamStream. You can directly mock it as follows and use it:
		FileItemStream item = Mockito.mock(FileItemStream.class);
        when(item.isFormField()).thenReturn(false);
        when(item.getName()).thenReturn("file");
        when(item.openStream()).thenReturn(stubInputStream);
7. Stream when once read, its read. The stream.available becomes 0 the second time.
8. ReflectionTestUtils.setField(fileUploadHelper, "fileRootFolderName", "/tmp");   ->  Set @Value properties, its the java variable name in " ", not application.yml
	reflection can be used to do many other thing about variables and stuff.
9. Rethrow exception...... catch(Exception e){ throw; } -> preserves stacktrace.... catch(Exception e){ throw e;} -> loses stacktrace
10. Whats the point of rethrowing the exception using throw e so  many times in file upload example ?????
11. Create a resources folder inside test, then we can save files like .json from which we can read data to populate stuff in our unit tests.
	For example, for to populate BusinessObjectData, we created HerdUtilsTest_BusinessObjectData.json inside resources.
	And then used Resources.toString(Resources.getResource(fileName), Charsets.UTF_8); from google.common.io to read from .Json into String.
	Then, BusinessObjectData businessObjectData = JsonUtils.unmarshal(BUSINESS_OBJECT_DATA_VALUE, BusinessObjectData.class); to convert to java object
12. We cannot mock Static methods of Mocked class using Mockito, so there are alternatives like jmockit which allows us to do so. Inside @Test method, we can
	    new MockUp<HerdUtils>()
		{
			@mockit.Mock
            public String getS3BucketName(BusinessObjectData businessObjectData)
            {
                return "testBucketName";
            }
        };
13. If we are checking for an exception lets say at line25, do we also need to mock lines after that, for unit testing???
14. BDDMockito.willAnswer( invocation -> { throw new FileUploadBase.FileSizeLimitExceededException("msg",100L,100); }).
		given(fileUploadHelper).uploadFile(any(), anyString(), anyString());   -> to mock the checked exception in mockito.
15. Best to always put values including "_" and "." for String.split into a final variable and then use it in methods, except for in unit tests.
16. Good practice to put private as much as we can.
17. when(fileStatusRepository.findByStatus(anyString())).thenReturn(Optional.of(fileStatusEntity));
		To mock a repository that has an Optional findBY().


---------------------------------------------------------------------------------------
10-21-2019
1. For retries, resilience4j or Spring retries
2. HerdDaoImpl.... Spring retry or resilience4j
3. To-do ->  MaxUploadSizeExceededException  ***
4. Rate Limiter (block too frequent requests), Bulkhead (avoid too many concurrent requests), Circuit-breaker..........Netflix hystrix....Resilience4j, and spring...
	exponential backoff,
6. Resilience4j has springboot2 support where we can use annotations @Retry, and fallback, by setting properties in application.yml :
	resilience4j.retry:
  instances:
    preRegisterBusinessObjectData:
      maxRetryAttempts: 3
      waitDuration: 5s
      enableExponentialBackoff: true
      exponentialBackoffMultiplier: 2
      retryExceptions:
      - org.springframework.web.client.HttpServerErrorException
      - java.io.IOException
      ignoreExceptions:
      - io.github.robwin.exception.BusinessException
5. Rest call to DM for file upload:
	1. First call is to preRegisterBusinessObjectData to get the s3 bucket location
	2. Second call to registerBusinessObjectStorageFiles to register the uploaded file
	3. Third call to updateBusinessObjectDataToValid after which SNS messages are triggered.
6. RestTemplate to call another API from a class. Herd had a method that we call which calls the API.
7.  String dataFileCompression = isDelFile ? nameParts[++i] : nameParts[i++];
									OR
            String dataFileCompression = nameParts[nameParts.length-1];
8. MockitoAnnotations.initMocks(this) VS @ExtendWith(MockitoExtension.class)   is the same.
9.  HttpServletRequest mockedRequest = Mockito.mock(HttpServletRequest.class) AND @Mock HttpServletRequest mockedRequest seem to not be the same.
10. Why does some method run without initializing the mock as well ????
11. AtsOrderType atsOrderType = Mockito.mock(AtsOrderType.class)  and @Mock AtsOrderType atsOrderType   turns out to not be the same;
12. FileItemStream file = Mockito.mock(FileItemStream.class); Pass this as parameter, and for every .getSomething(), mock the response

-----------------------------------------------------------------------------------
10-18-2019
1. use Files.size(diskFile) from java nio to get the file size from the path in disk
2. Herd_info table has data that we use to make a call to DM(using the s3 file prefix) to get the s3 location. enum table...Help himanshu with stats...
//Filename.split   deleted css javascript code....add ^ $
createdStatus uses the name
3. Substring vs Split
	 String dataFileFormat = fileName.substring(fileName.indexOf("."), fileName.lastIndexOf("."))
4.                 if(META.equalsIgnoreCase(fileName.substring(fileName.indexOf("."), fileName.lastIndexOf("."))))
                {
                    String metaFileFormat = fileName.substring(fileName.lastIndexOf("."));

                    if (!(metaFileFormat.equalsIgnoreCase(CSV)) && !(metaFileFormat.equalsIgnoreCase(JSON)))
                    {
                        throwIllegalArgumentException(fileName);
                    }
                }
                else
                {
                    String dataFileFormat = fileName.substring(fileName.indexOf("."), fileName.lastIndexOf("."));
                    if (!(dataFileFormat.equalsIgnoreCase(JSON)) && !(dataFileFormat.equalsIgnoreCase(CSV)))
                    {
                        throwIllegalArgumentException(fileName);
                    }

                    String dataFileCompression = fileName.substring(fileName.lastIndexOf("."));
                    if (!dataFileCompression.equalsIgnoreCase(BZ2))
                    {
                        throw new IllegalArgumentException(String.format(CatddConstants.FILE_COMPRESSION_INVALID, fileName));
                    }

                }
5. ToString using apache commong lang3
	@Override
    public String toString()
    {
        return new ToStringBuilder(this).append("id", id).append("fileName", fileName).append("fileType", fileType).append("fileSize", fileSize)
            .append("partitionValue", partitionValue).append("statusId", fileStatus).append("herdInfoId", herdInformation).toString();
    }
-----------------------------------------------------------------------------------------
10-15-2019
1. uniqueFolder.resolve(fileName);   .resolve from path java nio concatenates the fileName with uniqueFolder
2. Once the input stream is started to read upto a certain point. In order to get the entire stream later again we need to concat, (already read + remaining)
	SequenceInputStream -> Concat 2 input streams
3. Throws is like transferring the responsibility of handling the exception to the method calling it. Method calling it has to have a try catch or throws.
4. ReThrow exception -> If we dont handle exception, we simply rethrow it. using throws
5. ec2 has the root drive which also contains /tmp which acts as a disk space
6. Memory leak, OOM error,  Permanent generation(permGen space)......visualgc, Jmap -> tool to investigate OOM error
7. LOGGER.isInfoEnabled()??????
8. The moment we define any parameterized constructor, we must also define a no-arg constructor if we want to instantiate 
	the object of that class via a no-arg constructor.
9. For transactional database, we need primary key and better to have a constraint.
10. @UniqueConstraint and @Column(unique=true)
11. Constraint using @Id, is it primary key composite? or the primary key can be like an auto increment id and constraint can be something else?
13. Normalization rdb
14. PK, FK.........    @GeneratedValue(generator = TABLE_NAME + "_seq")
15. We use the data in herd_info to make a call to DM using s3_key_prefix, which returns us the s3 location.

-------------------------------------------------------------------------------------------
10-15-2019(FileUpload)

1. Rest endpoint available for UI to upload a file.
2. Api gets the file along with the fip login info from which we confirm if the filename and fip info matches.
3. verify the size, name, extensions etc
4. Extract info from file name and file upload, and populate the DB table

Basically :::
1. Create the file in db table. Received
2. Validation
3. Call DM with herd_info data to get the s3 location
4. upload the file
5. Register to DM
--------------------------------------------------------------------------------------------
10-15-2019(Rest URI Naming)
1. Use forward slash (/) to indicate a hierarchical relationships.
2. Do not use trailing forward slash (/) in URIs.
3. Use hyphens (-) to improve the readability of URIs.
4. Do not use underscores ( _ ).
5. Use lowercase letters in URIs.
6. Do not use file extenstions.
7. Never use CRUD function names in URIs.
8. Use query component to filter URI collection.
-----------------------------------------------------------------------------------------------
10-14-2019(Spring -> Came up terms)
1. AWT (Abstract window toolkit), upcasting, Factory Design Pattern, Driver class,Eager loading(with load on startup), Lazy loading(without load on startup)


-------------------------------------------------------------------------------------------
10-11-2019
1. Expression lambda Vs Statement Lambda
2. Adding a new package, add to @ComponentScan in main application class. Configs and everything is as of Module level.
3. CacheConfigurationBuilder.newCacheConfigurationBuilder(SimpleKey.class, EwsOrganizationDetails.class, ResourcePoolsBuilder.heap(10000))
						.withExpiry(ExpiryPolicyBuilder.timeToLiveExpiration(Duration.ofSeconds(3600)))
						  .withExpiry(ExpiryPolicyBuilder.timeToIdleExpiration(Duration.ofSeconds(0))));
	Doing as above, two .withExpiry overrides the first one. Need to find a way to chain it.
4. Xml-based Vs Annotation-based vs Java-based configuration
http://math.hws.edu/javanotes/c5/s1.html
-------------------------------------------------------------------------------------
10-09-2019
1. Himanshu code style check : multiple places.....
2. Do we need to log cache actions?
3. EhCache -> package net.sf.ehcache(version 2) VS package org.ehcache(version 3).....EhCache vs Redis
	TTI,TTL, Jcache, heap, offHeap, disk, 
	We could either do a ehcache.xml in resources(we need to specify in application.properties -> spring.cache.jcache.config: classpath:ehcache.xml)
	, or use CacheManager in cachingConfig method.(Xml configuration OR Java Configuration)
	<config
	   xmlns:xsi='http://www.w3.org/2001/XMLSchema-instance'
	   xmlns='http://www.ehcache.org/v3'
	   xsi:schemaLocation="
				http://www.ehcache.org/v3
				http://www.ehcache.org/schema/ehcache-core-3.7.xsd">

	   <!-- Default cache template -->
	   <cache-template name="default">
		  <expiry>
			 <ttl unit="seconds">500</ttl>
		  </expiry>
		  <resources>
			 <heap>1000</heap>
			 <!--To save in offHeap memory-->
			 <offheap unit="MB">10</offheap>
		  </resources>
	   </cache-template>

	   <!-- Cache configurations -->
	   <cache alias="ewsOrganizationCache" uses-template="default">
		  <key-type>org.springframework.cache.interceptor.SimpleKey</key-type>
		  <value-type>org.finra.catdd.model.dto.EwsOrganizationDetails</value-type>

	   </cache>
	</config>
	
	+
	
	@Configuration
	@EnableCaching
	public class CacheHelper
	{
	}
							OR
	----------------------------------------------------------						
	Below code does not require ehcache.xml
	package org.finra.catdd.dao.config;

	import java.time.Duration;

	import org.ehcache.config.builders.CacheConfigurationBuilder;
	import org.ehcache.config.builders.ExpiryPolicyBuilder;
	import org.ehcache.config.builders.ResourcePoolsBuilder;
	import org.ehcache.jsr107.Eh107Configuration;
	import org.springframework.beans.factory.annotation.Value;
	import org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer;
	import org.springframework.cache.annotation.EnableCaching;
	import org.springframework.cache.jcache.config.JCacheConfigurerSupport;
	import org.springframework.context.annotation.Bean;
	import org.springframework.context.annotation.Configuration;

	import org.finra.catdd.common.CatddConstants;

	@Bean
    public JCacheManagerCustomizer cacheManagerCustomizer() {
        return cm -> {
            cm.createCache("ewsOrganizationCache", createConfiguration(1000, Duration.ofMinutes(2)));
        };
    }

    private javax.cache.configuration.Configuration<Object, Object> createConfiguration(long size, Duration tti) {
        return Eh107Configuration.fromEhcacheCacheConfiguration(
            CacheConfigurationBuilder.newCacheConfigurationBuilder(Object.class, Object.class,
                ResourcePoolsBuilder.heap(size))
                .withExpiry(ExpiryPolicyBuilder.timeToLiveExpiration(tti))
                .build());
    }
	----------------------------------------------------------
	For the below configuration, couldnt find the CacheConfigurationBuilder:
	
	@Bean
    public CacheManager cacheManager()
    {
        SimpleCacheManager cacheManager = new SimpleCacheManager();
        cacheManager.setCaches(Arrays.asList(
            new ConcurrentMapCache("ewsOrganizationCache")));

        return cacheManager;
    }
	And
	package org.finra.catdd.dao.config;


	import static org.ehcache.config.builders.CacheManagerBuilder.newCacheManagerBuilder;

	import java.time.Duration;

	import org.ehcache.Cache;
	import org.ehcache.CacheManager;
	import org.ehcache.config.builders.CacheConfigurationBuilder;
	import org.ehcache.config.builders.ExpiryPolicyBuilder;
	import org.ehcache.config.builders.ResourcePoolsBuilder;
	import org.springframework.cache.annotation.CachingConfigurerSupport;
	import org.springframework.cache.annotation.EnableCaching;
	import org.springframework.cache.interceptor.SimpleKey;
	import org.springframework.context.annotation.Bean;
	import org.springframework.context.annotation.Configuration;

	import org.finra.catdd.common.CatddConstants;
	import org.finra.catdd.model.dto.EwsOrganizationDetails;

	@Configuration
	@EnableCaching
	public class CacheHelper extends CachingConfigurerSupport
	{
		private CacheManager cacheManager;

		public CacheHelper()
		{
			cacheManager = CacheManagerBuilder.newCacheManagerBuilder().build(true);
	//        cacheManager.init();

			cacheManager
				.createCache(CatddConstants.EWS_ORGANIZATION_CACHE,
					CacheConfigurationBuilder.newCacheConfigurationBuilder(SimpleKey.class, EwsOrganizationDetails.class, ResourcePoolsBuilder.heap(10000))
						.withExpiry(ExpiryPolicyBuilder.timeToLiveExpiration(Duration.ofSeconds(3600)))
						  .withExpiry(ExpiryPolicyBuilder.timeToIdleExpiration(Duration.ofSeconds(0))));

		}

		@Bean
		public Cache<SimpleKey, EwsOrganizationDetails> getEwsOrganizationCacheManager()
		{
			return cacheManager.getCache(CatddConstants.EWS_ORGANIZATION_CACHE, SimpleKey.class, EwsOrganizationDetails.class);
		}

	}
	
	--> Very simple implementation of cache using ConcurrentMapCache. Does not have any configuration
			import org.springframework.cache.CacheManager;
			import org.springframework.cache.annotation.EnableCaching;
			import org.springframework.cache.concurrent.ConcurrentMapCacheManager;
			import org.springframework.context.annotation.Bean;
			import org.springframework.context.annotation.Configuration;

			import org.finra.catdd.common.CatddConstants;

			@Configuration
			@EnableCaching
			public class EhcacheConfig {

				@Bean
				public CacheManager cacheManager() {
					return new ConcurrentMapCacheManager(CatddConstants.EWS_ORGANIZATION_CACHE);
				}
			}

4. Default value for @Value
	@Value("${some.key:my default value}")
	private String stringWithDefaultValue;
5. entries on heap meaning????   The maxEntriesLocalHeap enforcement is only going to count the number of key/value pairs(number of cache) you store in the cache ****
6. timeToLiveExpiry = creationTimeOfCache + timeToLive
	timeToIdleExpiry = mostRecentTimeCacheWasUsed + timeToIdle
7. We dont need to unit test configuration. (cross-cutting concerns)
8. If we need more cache for other methods, we can create another bean using the generic createConfiguration method, and the annotate @Cacheable in the new method
	to be cached.
9. EWS Cache unit test for methods using it. NOT WORKING CURRENTLY. Because it requires a junit Context(Spring context), instead of Application Context. Hard to do.
package org.finra.catdd.service;

		import static org.mockito.ArgumentMatchers.any;
		import static org.mockito.Mockito.when;

		import java.time.Duration;
		import java.util.ArrayList;
		import java.util.List;

		import org.apache.commons.lang3.time.StopWatch;
		import org.ehcache.Cache;
		import org.ehcache.CacheManager;
		import org.ehcache.config.CacheConfiguration;
		import org.ehcache.config.builders.CacheConfigurationBuilder;
		import org.ehcache.config.builders.ExpiryPolicyBuilder;
		import org.ehcache.config.builders.ResourcePoolsBuilder;
		import org.junit.jupiter.api.BeforeEach;
		import org.junit.jupiter.api.Test;
		import org.junit.jupiter.api.extension.ExtendWith;
		import org.mockito.InjectMocks;
		import org.mockito.Mock;
		import org.mockito.junit.jupiter.MockitoExtension;
		import org.springframework.beans.factory.annotation.Autowired;
		import org.springframework.boot.autoconfigure.cache.JCacheManagerCustomizer;
		import org.springframework.test.context.ContextConfiguration;

		import org.finra.catdd.common.CatddConstants;
		import org.finra.catdd.dao.EwsOrganizationRepository;
		import org.finra.catdd.model.dto.EwsOrganizationDetail;
		import org.finra.catdd.model.dto.EwsOrganizationDetails;
		import org.finra.catdd.model.entity.EwsOrganizationEntity;
		import org.finra.catdd.service.helper.EwsOrganizationHelper;
		import org.finra.catdd.service.impl.EwsOrganizationServiceImpl;

		import org.finra.catdd.dao.config.EhcacheConfig;

		@ExtendWith(MockitoExtension.class)
		@ContextConfiguration(classes = {EhcacheConfig.class})
		//@ContextConfiguration
		public class EwsOrganizationServiceImplCacheTest
		{
			@Autowired
			@InjectMocks
			private EwsOrganizationService ewsOrganizationService = new EwsOrganizationServiceImpl();

			@Mock
			private EwsOrganizationRepository ewsOrganizationRepository;

			@Mock
			private EwsOrganizationHelper ewsOrganizationHelper;

			private EwsOrganizationDetails ewsOrganizationDetails;

			private List<EwsOrganizationDetail> ewsOrganizationDetailList;

			private List<EwsOrganizationEntity> ewsOrganizationEntityList;

			private EwsOrganizationDetail ewsOrganizationDetail;

			@Autowired
			CacheManager cacheManager;

			@Autowired
			Cache cache;

			@Autowired
			JCacheManagerCustomizer cacheManagerCustomizer;


			@BeforeEach
			public void init()
			{
				ewsOrganizationDetailList = new ArrayList<>();

				ewsOrganizationDetail = createEwsOrganizationDetailObject(1011, "Test Firm inc.");
				ewsOrganizationDetailList.add(ewsOrganizationDetail);

				EwsOrganizationDetail ewsOrganizationDetail2 = createEwsOrganizationDetailObject(2022, "Test Firm inc. 2");
				ewsOrganizationDetailList.add(ewsOrganizationDetail2);

				ewsOrganizationDetails = new EwsOrganizationDetails();
				ewsOrganizationDetails.setEwsOrganizationDetails(ewsOrganizationDetailList);

				ewsOrganizationEntityList = new ArrayList<>();
				EwsOrganizationEntity ewsOrganizationEntity = createEwsOrganizationEntityObject(1011, "FIRM", 2, "Test Firm inc.");
				ewsOrganizationEntityList.add(ewsOrganizationEntity);
			}

			@Test
			public void testRetrieveEwsOrganizationDetails()
			{

		//                CacheConfiguration cacheConfiguration = CacheConfigurationBuilder.newCacheConfigurationBuilder(Object.class, Object.class,
		//                    ResourcePoolsBuilder.heap(1000))
		//                    .withExpiry(ExpiryPolicyBuilder.timeToLiveExpiration(Duration.ofSeconds(300)))
		//                    .build();
		//
		//                cacheManager.createCache(CatddConstants.EWS_ORGANIZATION_CACHE, cacheConfiguration);

		//                EhcacheConfig ehcacheConfig = new EhcacheConfig(1000, 3600);
		//                ehcacheConfig.cacheManagerCustomizer();

				when(ewsOrganizationRepository.findByCustomOrgTypesAndSubtypes(any(), any())).thenReturn(ewsOrganizationEntityList);
				when(ewsOrganizationHelper.convertEntityToDto(any())).thenReturn(ewsOrganizationDetail);

				StopWatch watch1 = new StopWatch();
				watch1.start();
				ewsOrganizationService.retrieveEwsOrganizationDetails();
				watch1.stop();
				System.out.println(watch1.getTime());

				StopWatch watch2 = new StopWatch();
				watch2.start();
				ewsOrganizationService.retrieveEwsOrganizationDetails();
				watch2.stop();
				System.out.println(watch1.getTime());

				// Verify repository method was invoked once
				//        verify(ewsOrganizationRepository, times(1)).findByCustomOrgTypesAndSubtypes(any(), any());
			}

			public EwsOrganizationDetail createEwsOrganizationDetailObject(Integer orgId, String firmName)
			{
				EwsOrganizationDetail ewsOrganizationDetail = new EwsOrganizationDetail();
				ewsOrganizationDetail.setOrganizationId(orgId);
				ewsOrganizationDetail.setOrganizationName(firmName);
				return ewsOrganizationDetail;
			}

			public EwsOrganizationEntity createEwsOrganizationEntityObject(Integer orgId, String firmType, Integer firmSubType, String firmName)
			{
				EwsOrganizationEntity ewsOrganizationEntity = new EwsOrganizationEntity();
				ewsOrganizationEntity.setOrganizationId(orgId);
				ewsOrganizationEntity.setOrganizationType(firmType);
				ewsOrganizationEntity.setOrganizationSubtype(firmSubType);
				ewsOrganizationEntity.setOrganizationName(firmName);
				return ewsOrganizationEntity;
			}
		}

------------------------------------------------------------------------------------------------
10-03-2019
1.@SpringBootApplication(exclude = { SecurityAutoConfiguration.class }) to disable default security and add our own
2. Have annotations like @Service, @Repository only in implementation layer, not the interface(Or maybe just the interface?)
3. Mockito Spy.... NotAMockException
4. public final static List<String> ORGANIZATION_TYPES = Collections.unmodifiableList(Arrays.asList("FIRM", "OTHER"));
5. Dont need unit test for repository interface if it does not have an implementation
5. verify()
6. Method name starting with verb
7. @SuppressWarnings("PMD.AvoidFieldNameMatchingTypeName")
8. Construction injection. properties from application.yml into application
	public class Test {
    private final String value;

    public Test(@Value("${some.value}") String value){
        this.value=value;
        System.out.println(this.value);
    }
	}
9.Mocking the application.yml for @value in junit5 using mockito.
	ReflectionTestUtils.setField(osoRelationshipHelper, "FINRA_HELP_DESK_NUMBER", "888-696-3348"); Also used to set value for a field without setter method
10. Better practise to put variables like phone number and stuff in application.yml than in java code.
----------------------------------------------------------------------------------------
09-30-2019
1. FastByteArrayOutputStream, BufferedReader, InputStreamReader, Byte[] vs ByteBuffer
2. .toArray(new String[0]) -> new String[] to make sure the Array is of type String. If nothing is specified, it is an object array.
3. CriteriaApi -> Dynamic Query builder
4. Criteria builder. Equals in <List> and other predicates:
		CriteriaBuilder criteriaBuilder = entityManager.getCriteriaBuilder();
        CriteriaQuery<ABCEntity> criteriaQuery = criteriaBuilder.createQuery(ABCEntity.class);
        Root<ABCEntity> ewsOrganizationEntityRoot = criteriaQuery.from(ABCEntity.class);
        List<Predicate> predicates = new ArrayList<>();
        Expression<String> expression = ewsOrganizationEntityRoot.get("organizationType");
        predicates.add(expression.in(organizationTypes));
        predicates.add(criteriaBuilder.notEqual(ewsOrganizationEntityRoot.get("organizationSubtype"), organizationSubtypeToExclude));
        criteriaQuery.where(predicates.toArray(new Predicate[predicates.size()]));
        criteriaQuery.orderBy(criteriaBuilder.asc(ewsOrganizationEntityRoot.get("organizationName")));
        return entityManager.createQuery(criteriaQuery).getResultList();
   
   @Mock
   Expression expressionMocked;
   when(criteriaBuilderMocked.upper(any())).thenReturn(expressionMocked);

------------------------------------------------------------
09-27-2019
1. Creating a rest endpoint: controller, dto as return type, 
-----------------------------------------------------------------------------------------
09-25-2019
1. Need to try to ways to upload:
	1. Stream the data to EFS(disk for local), and initiate a multipart from EFS to s3.
	2. Use a low level API to stream chunks(5mb) directly multipart upload to s3
	3. Streaming plus single part transfer manager
2. System.getProperty("java.io.tmpdir") -> users/AppData/Local/Temp/
3. https://community.oracle.com/thread/1455708    -> Temp file not deleted for DiskFileItemFactory                   item.delete();
4. Lower vs higher level API
--------------------------------------------------------------------------------------------------------------
09-24-2019
1.https://docs.aws.amazon.com/AWSJavaSDK/latest/javadoc/com/amazonaws/services/s3/model/PutObjectRequest.html
	https://github.com/aws/aws-sdk-java/issues/839 (Not possible)
	https://github.com/filestack/filestack-java
2. Steps for file upload from client -> Server -> s3
	1. Stream from client to Server using Apache commons file upload Stream API, Multipart upload
	2. Get the file size for the stream
	3. Stream to s3
3. content-length in @RequestHeaders for filesize 21474836 bytes gives 21475039 bytes, without speciying the content-length ????
4. keepAlive
5. sha-256 vs md5. SHA1, SHA2, SHA3
6. Digital Ocean vs AWS	
7. EFS vs
-------------------------------------------------------------------------------
09-23-2019
1. ModelMapper -> Entity To DTO Conversion for a Spring REST API
2. attachments3serviceimpl, herd for fileUpload
3. #Check to see how to get the size of the uploaded stream without hogging the memory.  1) Upload in chunks, by buffering like 1mb at a time 
4. ModelAndView, DispatcherServlet, @ConfigurationProperties
5. We use TransferManager instead of PutObjectRequest because it supports asynchronous uploads and downloads
6. BOM vs POM
---------------------------------------------------------
09-20-2019
1. Rest API for file upload
2. Audit table design
3. Transfer Manager to upload to s3
4. Let DM know
--------------------------------------------------------------------------------------------------------
09-19-2019
1. #Compare.....Using Java utitily to compare two files if they match
2. #Work on file upload Rest Api. 
3. BufferedReader, FileReader, InputStreamReader, mark() and reset(), IO vs NIO
---------------------------------------------------------------------------------------------------------
09-17-2019
1. #Create a wiki page for pros and cons of serverside multipart FileUpload using ApacheCommons fileUpload streaming and aws transfer manager ****
2. #James's pull request. make changes to it accordingly to submitter id and third party such that one organization can only see their data	****
3. SpEl,Spring AOP -> Join Point, point-cut(AspectJ) cross-cutting concerns
	The crosscutting concern is a concern which is applicable throughout the application and it affects the entire application. For example: logging,
	security and data transfer are the concerns which are needed in almost every module of an application, hence they are cross-cutting concerns.
4. StreamSupport.stream(organizationIdList.spliterator(), true).allMatch(o -> o == null)
5. When uploading directly from an input stream, content length must be specified before data can be uploaded to Amazon S3.
	-> If not provided, the library will have to buffer the contents of the input stream in order to calculate it.
	-> Amazon S3 explicitly requires that the content length be sent in the request headers before any of the data is sent.
	-> By buffering the entire stream into memory manually, this solution only repeats manually what the AWS SDK already does automatically,
	only this time without any printed warning! For a more efficient solution see my answer below
	ACL - Access control list
-----------------------------------------------------------------------------------------
09-16-2019
1. Aws s3 multipart file upload: Pros
	~ pick up where we left off while uploading.
	~ breaks your larger objects into chunks and upload a number of chunks in parallel
	~ Example : 5gb file can be broken into as many as 10,000 parts, where each part has to be atleast 5MiB. Makes it 50gb max size.
2. http://alexmojaki.github.io/s3-stream-upload/javadoc/apidocs/alex/mojaki/s3upload/StreamTransferManager.html
	https://aws.amazon.com/blogs/developer/parallelizing-large-uploads-for-speed-and-reliability/
3. Proxy/server file upload -> Tried Apache commons fileUpload Streaming + Aws multipart upload
	FileX - presigned url -> credentials good for 1 hour, use this url from browser to upload. Does not support Multipart
	 JavaScript s3 sdk version from browser to s3 upload.
4.	Verify if the streaming actually is doing multipart??? **Might only be possible with file.
	Multipart upload isn't possible for InputStream. Parallel upload would need to be able to read from different segments in the stream concurrently,
	i.e. we would need random access to the data.
		https://stackoverflow.com/questions/24955421/transfermanager-vs-putrequestobject-in-amazons3
5. Approaches :
FileX API 
User first calls FileX REST API to get the pre-signed URL, and then uploads the file to S3 using the pre-signed HTTP url. 

FileX S3 Direct
User first calls FileX to get the STS token and file location, and then uses AWS S3 Javascript SDK to upload the file to S3. 

Server Proxy 
User first uploads the file to Reporter Portal backend server, and then the backend server upload the file to S3 using S3 TransferManager.
-----------------------------------------------------------------------------------
09-12-2019
1. Multi-part upload : Uploading a single file as a set of parts. 3 step process, initiate upload(receive upload Id), upload each part(id + etag), finalize upload 
	Instead of using the lengthy 3-part multipart upload for every upload, use Aws sdk transferManager for ease.
	* Disk file item factory is not used. that means the the data is not stored in the disk first.
   access-key : 
   secret-key :
   Transfer manager : attempts to use multiple threads for uploads to improve throughput
   key : foldername/fileName is the key
   5 layers implementation AWS
   https://www.javacodegeeks.com/2017/03/amazon-s3-tutorial.html
2. aws-credentials-refresh.jar, .properties file, same folder. run the jar through command line to refresh the aws credentials
	That creates a credentials file inside .aws in the user directory. Also add config file with following data:
		[default]
		region=us-east-1
		output=json
		role_arn=arn:aws:iam::474848416659:role/APP_CATDD
3. Apache commons vs Apache tomcat for fileUpload imports
4. ?ssl=true;sslfactory=org.postgresql.ssl.NonValidatingFactory 
5. MD5 hashing algorithm, MD5 checksum
6. Read the contents into a byte array
   byte[] bytes = IOUtils.toByteArray(uploadedStream);
   metadata.setContentLength(bytes.length);
   ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(bytes);
			It loads it into the memory, the entire size, so not really a streaming.
7. #Need to figure out the stream size. Dig into transfer manager utility.
8. #How do we make sure transfer manager is using multipart file upload for streaming. 
9. Mebibyte(MiB), Base64
10. @PostConstruct

-------------------------------------------------------------------------------
09-11-2019
1. Batch process, namespace
2. #ATS check, if more than one expired ones, still says already exist ****
3. #Check if more than 1 effective in DB table, update and create....
4. Factory class
5. Monolithic vs microservices

--------------------------------------------------------------------------------------
09-09-2019
1. #File upload:
	Java web services, Jersey framework, HTTP Post encoding type:multipart/form-data
	USING: Apache Commons FileUpload -> Streaming API
2. Uploading from client to server, THEN, server to s3. Doing the 1st part now. Trying to store it in the memory
3. tomcat-embedded-jasper, jstl,
4. Default spring multi-part uploader needs to be disabled to use the apache commons fileUpload because the same request cannot be parsed twice.
	Uploading from postman, key : file, value : file upload
5. fsutil file createnew <file> <size in bytes>
	Creating a dummy file of any size command
6. # look into Aws sdk transfer manager.....how Streaming works with multipart together
7. encoding types: application/x-www-form-urlencoded and multipart/form-data
-----------------------------------------------
-------------------------------------------------------
09-04-2019
1. # Start by creating a DAO, entity, service, interface for getting the reference data and putting it in the table.
		OrgId, IMID, Audit entity info....
2. SQS is subscribed to SNS. Whenever there is an update in DM(herd), SNS notifies us with the file location and details. Then we use AWS SDK to get the file.
3. ControllerAdvice error handling spring for rest API
MQ,KAFKA, DLQ PCI data MPI data
-----------------------------------------------------------------------------------------------
09-03-2019
1. Lambda function
2. SQS Queue, that subscribe to SNS
3. F5, F3
4. ALB
5. Flowchart
6. Bastion host
7. FIP
8. ISSO Stack
9. EWS
10. IAM role,
11. X-path, chmod
--------------------------------------------------------------------------------------------------------
08-28-2019
1. #Use the same criteria builder we have for get, for both put and postgres ***
2. #update the constant and use it	***
3. #Remove the effective date thing from criteria builder (Himanshu) ***
4. #Include organizationId as a part of unique record for ATS or not? Himanshu		***
5. Null pointer for OSO ??? Himanshu. verify ATS  ***
6. Spaces and blank lines in code.
7. #Case sensitive query paramter..... Himanshu 
8. #Use entity for the query parameters
9. #Null bug bix for post ATS/OSO ***
10. Maven surefire

OsoRelationshipServiceImpl.java
/OsoRelationshipRepositoryCustomImplTest.java
OsoRelationshipRepositoryCustomImpl.java
------------------------------------------------------------------------------------------------
08-27-2019
1. #Bug???? is orgId part of unique combination???? **** Future this is true
2. hibernate-jpamodelgen
3. #Does case matter for findBy?????		** It should not
4. #For ATS, the findBy is still the regular JPA Query not the criteria builder one, for create and update. For Get its already there ! ???? Do it. Use same
5. Copy wrong unit test HINMANSHU for customRepoTEst ***
6. Need to do individual mvn clean install for seperate package to update it
-----------------------------------------------------------------------------------------------------------------------------------
08-22-2019
1. #Create a wiki page to create a constants class.
2. CollectionUtils class
3. Position based/named parameters for @Query in repository.
4. Two rest endpoint:
	    @GetMapping(value = "/atsOrderTypes", params = "processingDate")
		@GetMapping(value = "/atsOrderTypes", params = "atsOrderType")
5. Criteria builder to create dynamic queries based on different query parameter combination. 
	EntityManager, CriteriaQuery, Root, Predicate

---------------------------------------------------------------------------------------------------
08-20-2019
1. assertDoesNotThrow(() -> {return "Does not throw Exception!";}); to unit test if no exception is thrown
---------------------------------------------------------------------------------------------------------------------------------
08-14-2019
1. #Set expiration date when null to something far in the future	***
2.   /**
     * Handles duplicates for update
     * <p>
     * Note: The record is called a duplicate if another record with the same IMID, ATS order type, and can be updated to match the needs of the user
     *
     * @param newAtsOrderTypeEntity The new updated record.
     * @param existingAtsOrderTypeEntity The existing record that is being updated
     */
3. #Add more unit tests for ATS, more asserts		***
4. repository.save() return a new id;
---------------------------------------------------------------------------------------
08-13-2019
1. http://localhost:8080/swagger-ui.html
	@ApiModel, @ApiModelProperty, @Api
-------------------------------------------------------------------------------------
08-12-2019
1. Code coverage tools : Atlassian Clover, Cobertura, JaCoCo
2. package org.omg.portableserver does not exist --> Recompile, or add to git staging first
3. Fluent interface vs Application builder
	 ApplicationUser applicationUser = new ApplicationUser.ApplicationUserBuilder().userId(USER_ID)
                    lastName(LAST_NAME).build();
4. #update helper class to check expiration date with current date
5. DB_PASSWORD=ENC(CATDD.dev.catdd_appuser) in dev.dictionary to get password from credstash
-------------------------------------------------------------------------------------
08-09-2019
1. Good practise to put simple date formatter inside method that uses it instead of creating a static due
	to its thread-unsafe nature.
	Also, for setting up current date, use instantly. dont create variable at the begining.
2. Good practice to final static variables, and not the object declaration itself.
3. Good practice to put the versions of pom dependency in the <properties/> like
	actual version value.
4.	How do you know the current user?
	Yes, through a cookie - FIP cookie.  FIP sits in front of the Portal Application.
	It does authentication, and then injects the userId, entitlements, orgId..etc
	into the request headers.  Portal app builds an user object based on this information.
	This endpoint will read the user object using Spring SecurityContext.
	The user object is also used by the app for its security model (which endpoint
	this user can access). 
-------------------------------------------------------------------------------
8-06-2019
1. Spring Security: 
	* Setting in application.yml
	* Never put configuration files in the application because we can't change it while
	the application id deployed.
2. mvn clean install -DskipTest
3. mvn checkstyle:check, mvn pmd:check, mvn findbugs:check
4. Object mapper. Json object to string
5. Marshal/Unmarshal -> Convert to byteStream/Convert back to data, like serialization
6. ApiOperation, ApiResponses for swagger
7. @BeforeAll, @BeforeEach. Avoid @BeforeAll because for running parallel tests, it might
	not get the value.
8. Run clover for test coverage report:
	mvn clean package clover:clean clover:instrument clover:aggregate clover:clover
	Target:site: index.html -> WebPage to show the details
9. Branch coverage

------------------------------------------------------------------------------
07-31-2019
1. Multi-module project 
2. Connection Pool, Embedded tomcat configuration for production environment( Not using default)
3. Test Post and Put.  NOW
4. Helper class for validation (validation on the efctv_dt)
5. Thrd_prty and cat_submtr_id oso **** Assigned to Himanshu
6. Remove eplicit update_ts because hibernate manages it ****
7. Add sequence names and stuff in Entity id
8. FindById() override for active indicator??
9. Check violations.
10. If active indicator=i for toUpdate, ?????...
11. PMD, CheckStyle, FindBugs...Source code analyzer
12. f12 for inspect if user is smart to see stuff
----------------------------------------------------------------------------------------------------------
07-26-2019
1. #base class, AuditEntity that can be extended to any class   @MappedSuperclass, @Version(for concurrent update)
	Hibernate verison optimistic lock
2. #Rename entity classes to AtsOrderTypeEntity
3. #DTO package
4. #@Transactional.... Transaction manager in service layer
5. #Dependency management, pom for everything dao,
6. #Helper funciton
7. #Import the Finra base in eclipse
8. Look into herd
9. #Remove date validation	****
10. #Code style. Import in eclipse(or intelliJ).....(Alt+Ctrl+L to make changes)
	(Alt+Ctrl+O to remove unused imports)
11. Wiki APi page


//If effective date after Current Date OR effective date = Current date 
		if(!newAtsOrderTypeEffectiveDate.before(currentDate)) {	
			//If expiration date after effective date OR effective date = expiration date
			if((newAtsOrderTypeExpirationDate==null) || (!(newAtsOrderTypeExpirationDate.before(currentDate)))) {
------------------------------------------------------------------------------------------------------------------
07-25-2019
1. AppSec(Application Security)
2. Zero Down time(blue-green switch)
3. #Api documentation
4. #buildinfo, currentUser, error info, exception handler class
5. GoDaddy : Domain name registrar
6. Route53 : 
7. Use Junit5, Springboot
8. Don't have SYSO in the application. Bad practise
----------------------------------------------------------------------------------------------------------
07-22-2019
1. #Filter by efctv_dt or updt_dt whichever is latest. (A new Max-of column, then sort by that)  ****
2. #Error response message(Relationship already exists for all)	****
3. #For OSO and ATS, Active indicator in db(boolean column). If a record is updated, make that one inactive, and create a new one
	propagating the same data. PLUS updating the uptd_dt and uptd_ts. Add original id too, when the record is totally updated,
	we link it to the original id that was updated
4. X-path, AWS SDK, AOP, Camelcase, Spring security, Use Spring data - NO JPA  
5. Headers : map, multi-map and httpheaders object...........@RequestHeaders	
6. Cross-site-scripting(XSS) : injecting malicious script from front end
7. Unit test DAO? Maybe Not
8. We can Fork a repo, then clone it. From local, push changes to fork and create pr from fork to the repo 
------------------------------------------------------------------------------------------------
07-19-2019
1. #Do unit testing for OSO
-------------------------------------------------------------------------------------------------
07-18-2019
1. Thrd_prty and cat_submtr_id and cat_rprtr_imid combo has to be greater than the same cat_submtr_id and cat_rprtr_imid combo
----------------------------------------------------------------------------------------------
07-17-2019
1. #indexOf giving -1(not found) for ones with null expiration date	**** Use Iterables.getLast instead
2. #Exp and efctv validation	****
3. #Case insensitive	****
4. # find by id null	****
5. #if nothing changed, and update submitted????? No changes made ****
6. #If UI passed the id for updating the effective date, could be done. Validation part  ****
7. For Updating an effective record, the efctv_dt is always <= current Date, and it always fails validation,	
	So in the custom validation constraint for efctv_dt, make it class level, and either pass different payload from UI for
	already efctv vs future efctv, and based on the difference skip the validation. OR Just get the to-update row from repo
	in the constraint validator class and check if it is efctv in the past or future.
-------------------------------------------------------------------------------------
07-16-2019
1. #Change the Post API, remove all the weird scenarios		****
2. #@Valid for 2 cases for update, future effDate and existing	****
3. #Can we create multiple records for future as long as it is efective where last one ends? NO ****
4. #For update, if 07-25:07-27,and 07-27:07-30, can they update the first record? NO ****
5. For order by, if we are using native query, we can do Greater('create_ts','update_ts) which will sort by whichever is greatest for each record.
	Jpa might not have this for criteria builder. NOT sure.
---------------------------------------------------------------------------------------
07-15-2019
1. objectError.getCode() to get the field name for object error. Changed class name to match fieldName.
2. #Remove the boilderplate codes
3. #Null pointer exception showing when thrd_prty is empty. ***
4. Postgres sql query for where 'id=null' is 'id is null'
5. order by efctv_dt, xprtn_dt.... Orders first by efctv_dt and then if efctv_dt are the same, orders the same ones by xprtn_dt
6. listIterator.next() moves to next everytime it is called. Two syso of same thing print different result.
7. S3 select
------------------------------------------------------------------------------------------------------------------
07-12-2019(Api review)
1. Save cache for crd_id and delete everyday at the end.
2. #Make * for cross origin, upto *.catnms.com
3. Different previleage different crd_id will have, some will have read-only, while some
	have admin rights. Let them add or just view depending on previleage.
4. #Send fieldnames in response along with response message,	****
	example: cat_rprtr_imid, cat_rprtr_imid must not be null	*** ?Ask Lavanya, Map, : instead of ,
5. #Json format of response:	****
		{
			"status":"Ats Order Type created"
		}
		{
			"status":"Failed to created Ats Order Type",
			"errors":{
					cat_rprtr_imid, cat_rprtr_imid must not be null,
					ats_order_type, ats_order_type must not be null
				   }
		}
		{
			"status":"Duplicate Ats Order Type"
		}
6. #Add Ramiz as code-reviewer
7. #Temporary hard code real values for input, meeting with sunny and lavanya.		****
8. #Exact same input twice: Duplicate example: 07-20 : 07-20, input 07-20 : 07-20	****
9. #Update API changes will not have delete and add, we can update directly. Response 200
10. #	JPMC ABC 07/12 07/13
		JPMC ABC 07/14 07/15
		Can one create 07-13 : 07-14 ?			For now we can.
		
	#	JPMC ABC 07/12 07/14
		Can one create 07/14 07/14 ?	For now we can.
11. #Swagger for rest
12. Send custom headers response: HttpHeaders httpHeaders=new HttpHeaders[];
13. Response Map<String,Object> to return a json response with name-value pairs, with
	different value types. (Check Also: ObjectMapper, visibility, JSONobject)
--------------------------------------------------------------------------------------
07-12-2019
1. Scenarios that I checked for post OsoRelationship
	ExistingInDB	    Scenarios	
	07-13 : 07-16 ->	07-11 : 07-12	 08-06 : 08-16
	07-20 : 07-25 ->	07-16 : 07-19	 07-13 : 08-15
	08-01 : 08-06 ->	07-26 : 08-01	 07-22 : 07-28
2. Cast Object Error to field error
3. #Do we need to respond that a field only accepts long and not string ???? NO, it comes 
	from erd reference validation *****
4. #ATS:
		1. effective today and expiration today, PrevRecordExpdate=today? Yes create****	
		2. Duplicate primary key ! ??? Change primary key to Serial no. ATS ****
			JPMC ABC 07/12	07/12	
			JPMC ABC 07/12	08/01
5. Custom constraint validation. If same validation rule applies for 2 different entity classs,
	could share the constraintValidation class by providing Object object and checking if(object instanceof CLASSNAME)

---------------------------------------------------------------------------------
07-11-2019
1. #Do the Post API for OSO first, Review tomorrow, and we will come back to ATS Post Api later and fix it ****
2. Field error vs Global error vs Object Error in binding result
3. #Verify Error message response and response codes.
4. @NotBlank vs @NotEmpty
5. #The Binding result error message order is not consistent ? Its Ok if random***
6. Multiple constraint order of excution in hibernate bean validation: 
	interface Cheap {}
	interface Expensive {}
	@GroupSequence(value={AtsOrderType.class, Cheap.class,Expensive.class})
	And provide groups={Cheap.class or Expensive.class} in the constraint fields
	{NOTE: the names cheap,expensive could be changed and the priority of names depend on the order it is put in
	@GroupSequence...}		-> SKIPPED ! Not working as expected
7. To check for valid effective, and expiration date in ATS, avoided .before and .after and chose compareTo to prevent
	null pointer exception
8. Scenarios that I checked for post ATS:
			Current: 07-10-2019
		Existing in DB			Scenarios
		07-12 : 07-14		->	07-11 : 07-11R# 		08-15 : 08-20G#	 
		07-22 : 07-24		->	07-15 : 07-21B# 		07-20(or any before xprn of last) : 08-20H#	  		
		08-02 : 08-06		->	07-25 : 08-01B# 		07-23 : 08-01H#
		08-09 : 08-15 		->	08-06 : 08-09E#			07-24 : 08-01B#

		Current: 07-10-2019
		Existing in DB			Scenarios
		07-12 : 07-14		->	07-11 : 07-11R# 		08-15 : 08-20F#	 
		07-22 : 07-24		->	07-15 : 07-21B# 		07-20(or any before xprn of last) : 08-20S#	  		
		08-02 : 08-06		->	07-25 : 08-01B# 		07-23 : 08-01S#
		08-09 : null 		->	08-06 : 08-09D#			07-24 : 08-01B#   		
-------------------------------------------------------------------------------------------------------------
07-10-2019
1. Always Put ==null first for && condition so that .before and .after null doesnot come up
2. Custom validation binding result, field, property and class level
3. The BindingResult must come right after the model object that is validated or else Spring 
	fails to validate the object and throws an exception.
---------------------------------------------------------------------------------------------------------------
07-09-2019
1. #Error message, send every error as a response	****
2. #Check different scenarios in wiki	****
--------------------------------------------------------------------------------------------------------------
07-08-2019
1. #Accept filters front front end. For now, do from UI but get it done for API too. Skip for now***
2. ExceptionHandlers, @ControllerAdvice. Implement best practise
3. #Start POST API	***
4. #ATS Validations update 	****
5. #Does response message from API matter?	Yes ****
6. SNS & SQS.
7. #Is list fetched from DB table sorted by primary key? NO, for now create_ts desc ****
-------------------------------------------------------------------------------------------------------------
07-03-2019
1. #Cross-origin does not yet support ui.finra.*.catdd.com, we can have wildcards at front only. How do we do it?
	For now, just allow everything ***
2. We get the headers from ERD and store it in the session
--------------------------------------------------------------------------------------------------------------
07-02-2019
1. #Change the oso composite to only serial number as primary key ***
2. #Change the order of table columns ***
	Manually create a table, map the name with entity class name, and drop the old table
3. #Filter the get request

--------------------------------------------------------------------------------------------------------------
07-01-2019
1. Add @Valid in obj with @EmbeddedId for validation
2. #Create a Get API to accept filters to get data(UI passes the column names for everything)Make everything optional.
	Just do the filter not the sort. Sorting is done in front end.
3. #Add Version....v1 ***
4. #Add Lombok
5. Dont directly add to Portus, CM is managing everything through Bitbucket, The security groups are to be added to the build,
	that way, when we need to go QA,we just need to deploy to QA and all the security group will already be there. Thats what
	Portus 2.0 is.
6. Dont give the full path for DNS, it changes across different environment so we need to set relative path and create 
	a properties file to get the environment specific dns. API differs for different environment
7. Sundari: Build is successful now. The issue was that, by default, all build jobs run in the DEV (finra-dev) env
	And finra-core-dev has no access to finra-cat-dev. Changed the build job to run in CATDEV , it was a change in the build job
	settings (in f3 code: https://bitbucket.finra.org/projects/CATDD/repos/catdd-f3/browse/f3/api_pipeline.groovy#42 ).
	The jenkins job is completely automated, all the manual changes like env,roles have been removed and configured in f3.
	All the settings are taken care by: https://bitbucket.finra.org/projects/CATDD/repos/catdd-f3/browse/f3/api_pipeline.groovy 
---------------------------------------------------------------------------------------------------------------
06-28-2019
1. #Iterable<AtsOrderType> list=atsOrderTypeRepository.findAll(); Get it FIXed. This retrieves all(a lot of data) *** Verify
	Modify AtsOrderType Service create accordingly
2. #Iterable.getLast() only gets the last one in iterable. what if the last one is not yet effective and there can be multiple
	ones for future date. Or a later effective date can be first in Iterables before an earlier one
3. #Pass filters from UI to API and getAll accordingly 

4. Nguyen, Thanh -> you will need to submit a SG group update request, from Jenkins-web-slaves to your RDS in DEV account
	security group request....or actually you can do it with Portus
	the RDS is running at port 5432, right?....just go to https://portus.finra.org....and add an inbound rule from JENKINS-web-slaves
	at port 5432 to your RDS security group..by the way is the RDS is in CATDEV or DEV account?..If in catdev.
	you will need to change the cluster the job is running on to CATDEV as well
 
 5. The application without unit test for controller when run starts in ec2 and the inbound rules allow the ec2 instance
	to connect to the database but during the unit test when the application is started the jenkins-web-slave is trying
	to access the database and not the ec2 thats why we need to add another inbound rules for JENKINS-web-slaves
----------------------------------------------------------------------------------------------------------------
06-27-2019

1. #Business Rules for OsoRelationship create like if expired relationship, create new with same combo,
2. Semantic primary key vs technical primary key.............UUID
3. Sequence in database table in hibernate_sequence.AUTO denotes current index
	Sequence, auto, table, identity
-----------------------------------------------------------------------------------------------------------------
06-26-2019
1. #Try in OSO, add composite with serial number
2. #Build and Deploy in Dev. Error due to Unit test(integration test like)
	Tests Can't communicate with database directly 
3. @Mock vs @MockBean ??? use mockbean in controller where we use endpoint and has dependendcy to spring boot container,
							use mock in a regular class where we dont need dependendcy from springboot container	***
4. Cannot put @NotEmpty for integer !!!
5. @EmbeddedId in CompositeObj VS @IdClass in EntityClass, 
	put BindingValidation rules in entityClass,not in composite
	Cannot add GeneratedValue while using @EmbeddedId, Only possible with @IdClass
------------------------------------------------------------------------------------------------------------------
Look into:
-------------
Nightly build
concourse
swagger
java reflection API
CodeCoverage
transactional database like postgres
howtouseFtp
Yaml syntax
Sql commands
JPQL
----------------
pagination and sorting
dockers
entry point and cmd

get by sort descending		****
grep commands
learn linux commands dockers command

Sundari: check the difference between xml and yml syntax for accessing env vars in a springboot app. 
		I looked at log4j2.yml of a different app and saw that they used `sys`, hence tried it.

How git work....Resolve merge conflicts???
whats git stash git stash pop???
git add -p to commit only certain lines from a file
git add, commit and push only certain files

What we were doing for test is like integration testing
 
***Sundari: I am referring to tests that being run during the build
		they cannot communicate with the DB directly 
		The security settings on the DB only allow Inbound from CATDD-internal security group which is applied on the ECS instances
		Please check the settings of CATDD-internal and CATDD-protected security groups

-----------------------------------------------------------------------------------------
06-24-2019
Questions:
Primary key? 
Validation rules?

1. #merge feature/API to develop branch....
2. #http get sort by create_ts descending		****
3. #OSO story

FTP SFTP FtpClient filezilla, cyberDuck....FTPServer....
-----------------------------------------------------------------------------------------
***PostGres Connection error(Below:) --> Enable AppGate
10:35:36 org.postgresql.util.PSQLException: The connection attempt failed.
10:35:36   at org.postgresql.core.v3.ConnectionFactoryImpl.openConnectionImpl(ConnectionFactoryImpl.java:292) ~[postgresql-42.2.5.jar:42.2.5]

-----------------------------------------------------------------------------------------
06-19-2019

1. #Test Cases(controller mock**, services logical**)(naming ***,url check ***)
2. #Bootcamp
3. #SourceTree
4. BDD vs TDD
5. made changes to the branch online (log.yml) ***
6. test cases creates a data in table too. so comment. For DEV.... QA has a seperate table for testing
	public void testRetrieveAtsOrderTypeOfCrdId_Success() test case updates		-->Integration testing ***
7.	Optional......get() remember	***
8.	Optional.of()		***
8.	AMI(3 months back)		***
---------------------------------------------------------------------------------------------------------
06-18-2019

1. #Http and Https configure	(listener rules in ALB to take care of requests on port 80(http) can do it)	***
2. Logs/app.log error (????PET team.   Maybe Geetha or Harish,Maybe there's somethign in your springboot config that's failing to load system env vars)
3. #PgAdmin UI problem.		For right now, just install pgAdmin again and launch at the very first pop up.
4. #loose coupling. Application check for it ***
5. #JPQL vs SQL (Check for sql injection)	***
6. #Unit tests update
7. #Do we use getAll at all and expire? ****NO. Get rid of it
8. #what server is ec2 deployed in? **** Tomcat, set by CM
9. #when log files are created, where is it saved? ****(APP_LOG_PATH) Its the environment variable set with the docker image
---------------------------------------------------------------------------------------------------------
06-14-2019

Questions:
1. #For effective today, what time does it become effective?Ans-only date. And whats the action(let update everything, or just 2).Ans-Only 2 ****
---------------------------------------------------------------------------------------------------------
06-13-2019

Questions:
1.#table created in public schema for catddd database. Other database works just fine *** (leave it for DBA)
2.#Update AtsOrderType question. ****

3. .equals() and hashcode()	has to be overridden together	****
---------------------------------------------------------------------------------------------------------
06-12-2019

1.#expire atsorder type for the one that has null expiration date ****
2.#unit tests(controller(anyString))(service, "create_user_id) *****
3.#If effective date is in the future cannot expire. *****
4.#create database in schema, not public (Schemaname.tablename??Autocreating table in public schema)***(leave it for DBA)
5.#update(futureDate)..Delete the old obj,create a new one..(what abt Update username, update ts remains empty)****

6. (@Table(schema="catdd") creates table in public and specified schema while
7. (spring.jpa.properties.hibernate.default_schema=catdd only creates the specified)
8. application.properties(dev) overrides application.properties codes
---------------------------------------------------------------------------------------------------------
06-11-2019

1. #LOB problem, JDBC type, not the one in properties file.. ANS - Enabling BLOB,CLOB ****
2. #Not selecting dev application properties while deployed? why?   
3. Maven dependendcy tree	****
4. @ConfigurationProperties	****
5. wrapper around		****
6. YAML	****
7. Dependency from springboot vs apache		****
---------------------------------------------------------------------------------------------------------
06-10-2019

https://wiki.finra.org/display/RAMPDI/Data+Collection+Service?preview=%2F1084055503%2F1084055530%2Froot.crt
https://bitbucket.finra.org/plugins/servlet/search?q=root.crt

1. #expire, update ts and update id   *****
2. #new Ats order type added. nO need the trade date.    *****
	Eventually be in the final database but not on the submit database  ****
3. #Reference data come from s3...  ****
4. #Case sensitive. Enter as is. save as is   *****
5. #Validation rules Everything  *****
6. #Ats Order Type view only receives imid,atsOrderType,desc,effDate,createdDate,expDate(Directly
	send object, UI filters and takes)   *****
7. #Get method not needed. Get all only required   *****		Now get all not required

Questions:
8. #For Update(effDate=Future date), how? ats primary composite keys how to change?Delete and re-create? YES ****
9. #How is the current ats order type table connected to the final table..after getting validation passed ?
10. #What exactly is the fip parameters ?
------------------------------------------------------------------------------------------------------------------------------------
06-07-2019
1. sudo commands
2. #The docker container is not up. Exits in matter of few seconds....
3. SundariEmail: For FIP, I made fip_exclusion_list as * and fip_userprops as *...still showing whatever error.
	Look for cluster name in splunk after we run the deployment, if we see same error, just paste the error from splunk in the email
4. #Deploy the application
5. #Connect to RDS Postgres  ****
 -----------------------------------------------------------------------------------------------------------------------------------
06-06-2019
1. Set exception message for lenient=OptBoolean(FALSE);		
2. enum, joda time		
3. Once the application is running in production, we dont keep deploying instances.
	We will have scripts to deploy and DDl or any fixes   
4. Sundari:DNS issue is resolved
	https://api.portal.dev.aws.catnms.com 
	We are seeing an RSA Access manager login successful msg.
	This is related to FIP	
	We need the exact splunk error to be able to report to FIP team


Appendix:
# -> needs to be done or Asked
Regular -> Note for future
**** -> Resolution or done
